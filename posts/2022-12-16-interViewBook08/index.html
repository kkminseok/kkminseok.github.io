<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - URL 단축기 설계" /><meta name="author" content="minseok" /><meta property="og:locale" content="ko" /><meta name="description" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초 책 정리 글입니다." /><meta property="og:description" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초 책 정리 글입니다." /><link rel="canonical" href="https://kkminseok.github.io/posts/2022-12-16-interViewBook08/" /><meta property="og:url" content="https://kkminseok.github.io/posts/2022-12-16-interViewBook08/" /><meta property="og:site_name" content="민석강" /><meta property="og:image" content="https://kkminseok.github.io/assets/img/book/interview/logo.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-16T01:02:00+09:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://kkminseok.github.io/assets/img/book/interview/logo.jpg" /><meta property="twitter:title" content="가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - URL 단축기 설계" /><meta name="twitter:site" content="@none" /><meta name="twitter:creator" content="@minseok" /><meta name="google-site-verification" content="_icgy_j24DLYroQvKYTiffcqemP7ldWCxmrM2cGtYck" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"minseok"},"dateModified":"2022-12-16T01:02:00+09:00","datePublished":"2022-12-16T01:02:00+09:00","description":"가상 면접 사례로 배우는 대규모 시스템 설계 기초 책 정리 글입니다.","headline":"가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - URL 단축기 설계","image":"https://kkminseok.github.io/assets/img/book/interview/logo.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://kkminseok.github.io/posts/2022-12-16-interViewBook08/"},"url":"https://kkminseok.github.io/posts/2022-12-16-interViewBook08/"}</script><title>가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - URL 단축기 설계 | 민석강</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="민석강"><meta name="application-name" content="민석강"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/sample/logo.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">민석강</a></div><div class="site-subtitle font-italic">3년차 개발자. 40살에 100억벌고 은퇴</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kkminseok" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/none" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['minseok19950727','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - URL 단축기 설계</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - URL 단축기 설계</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/kkminseok">minseok</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1671120120" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-12-16 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2585 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><blockquote class="prompt-info"><div><p>가상 면접 사례로 배우는 대규모 시스템 설계 기초 책 정리 글입니다.</p></div></blockquote><h1 id="개요">개요</h1><p>URL 단축기는 말그대로 URL을 줄이는 모듈을 말한다.</p><h2 id="️-1단계-문제-이해-및-설계-범위-확정"><span class="mr-2">✏️ 1단계 문제 이해 및 설계 범위 확정</span><a href="#️-1단계-문제-이해-및-설계-범위-확정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>여태까지 그래왔듯 질문을 통해 요구사항을 명확히 해야한다.</p><ul><li>트래픽의 규모는? (예제에서는 매일 1억개의 단축url생성)<li>url의 길이는? (예제에서는 최대한 줄이도록)<li>url문자제한은? (예제에서는 0~9숫자, a~Z, A-Z 알파벳)<li>url을 시스템에서 지우거나 갱신 가능? (예제에서는 불가능)</ul><p>고로 이 시스템의 기본 기능은 다음과 같다고 한다.</p><ul><li>URL단축: 주어진 긴 URL을 훨씬 짧게 줄인다.<li>URL 리다이렉션: 축약된 URL로 HTTP 요청이 오면 원래 URL로 안내<li>높은 가용성과 규모 확장성, 그리고 장애 감내가 요구</ul><p><strong>개략적 추정</strong></p><ul><li>쓰기 연산: 매일 1억개 단축URL 생성<li>초당 쓰기 연산: 1억/24/3600 = 1160<li>읽기 연산: 여기서는 읽기와 쓰기 비율이 10:1로 가정. 그러므로 1160 * 10 = 11,600<li>URL 단축 서비스를 10년 운영한다하면 1억 * 365 * 10 = 3650억URL을 저장할 레코드가 필요.<li>축약 전 URL의 평균 길이는 100이라 가정.<li>따라서 10년 운영에 필요한 데이터 저장 용량은 3650억 * 100 = 36.5TB</ul><hr /><h2 id="️-2단계-개략적-설계안-제시-및-동의-구하기"><span class="mr-2">✏️ 2단계 개략적 설계안 제시 및 동의 구하기</span><a href="#️-2단계-개략적-설계안-제시-및-동의-구하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="api-엔드포인트"><span class="mr-2">API 엔드포인트</span><a href="#api-엔드포인트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>API 엔드포인트로 서버와 통신할 것이기에, REST 스타일로 설계를 한다.</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>POST /api/v1/data/shorten //책에는 이렇게 되어있는데, Restful하게 짜려면 명사를 사용하는게 좋다 그래서 나는
POST /api/v1/short-url 로 하겠다.
인자: {longUrl: longURLString}
반환: 단축URL
</pre></table></code></div></div><p>URL 리디리렉션용 엔드포인트: 단축 URL에 대해서 요청이 오면 원래 URL로 보내주기 위한 용도의 엔드포인트이다.</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>GET /api/v1/shortUrl //책에는 이렇게 써져있지만 나는
GET /api/v1/short-url //로해서 POST와 동일하게 하였다.
반환: HTTP 리다이렉션 목적지가 될 원래 URL
</pre></table></code></div></div><p>즉,</p><p><img data-src="https://user-images.githubusercontent.com/30401054/208023464-4583ad85-0746-493d-87c2-985f0c71b68d.png" alt="image" data-proofer-ignore></p><p>이런식으로 요청의 흐름이 이루어질 것이다.</p><p>301 응답과 302응답의 차이점에 대해 간단히 짚고 넘어가야된다.</p><ul><li>301 응답(Permanently Moved): 브라우저가 응답을 캐시해서 추후 같은 단축URL에 요청을 보낼 필요가 있고 요청이 도착하면 브라우저는 캐시된 원래URL로 보내버린다.<li>302 응답(Found): 클라이언트의 요청은 언제나 단축URL 서버에 먼저 보내진 후에 원래 URL로 리다이렉션 된다.</ul><p>첫 번째 요청만 단축URL 서버로 전송되기 때문에 서버 부하를 줄이기엔 301이 낫다.</p><p>그러나 트래픽 분석이 중요할때는 302를 써서 클릭 발생률, 발생 위치 등을 추적하는 것도 좋다.</p><h3 id="url-단축"><span class="mr-2">URL 단축</span><a href="#url-단축" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="https://user-images.githubusercontent.com/30401054/208024379-7db93665-f4f0-4ae5-83f4-fc3f16224f80.png" alt="image" data-proofer-ignore></p><p>이런식으로 원본URL이 어떠한 해시함수에 들어가면 단축URL로 바뀐다고 생각하자. 요구사항은 다음과 같다.</p><ul><li>입력으로 주어지는 긴 URL이 다른값이면 해시 값도 달라야 한다.<li>계산된 URL은 다시 원본 URL로 복원될 수 있어야 한다.</ul><hr /><h2 id="️-3단계-상세-설계"><span class="mr-2">✏️ 3단계 상세 설계</span><a href="#️-3단계-상세-설계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="데이터모델"><span class="mr-2">데이터모델</span><a href="#데이터모델" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>&lt;단축URL,원본URL&gt;을 쌍으로 가지는 해시테이블을 만들 수도 있겠지만, 메모리는 유한하고 비싸기에 이러한 쌍을 RDB에 저장하는 편이 좋을거라 생각이 든다.</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>   url
--------
PK    id
    shorUrl
    longUrl
</pre></table></code></div></div><p>을 컬럼으로 가지는 테이블을 만든다.</p><h3 id="해시-함수"><span class="mr-2">해시 함수</span><a href="#해시-함수" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>원래 URL을 단축URL로 만드는 해시 함수를 만들어야 한다.</p><h3 id="해시-값-길이"><span class="mr-2">해시 값 길이</span><a href="#해시-값-길이" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>단축URL은 0~9, a-z, A-Z까지의 문자들로 구성된다. 따라서 사용할 수 있는 문자의 개수는 10 + 26 + 26 = 62개이다. 이 시스템은 10년간 운영될 3650억개의 URL을 중복없이 담아야하므로, $ 62^n &gt;= 3650억 $을 넘는 n을 구해야한다.</p><p>이러한 n은 7이고 이는 3.5조개의 URL을 만들 수 있다. 따라서 단축URL의 길이는 <strong>7</strong>이다.</p><p>함수 구현에 쓰일 기술로는 <strong>해시 후 충돌 해소</strong> 방법과 <strong>base-62 변환</strong>법이 있다.</p><p><strong>해시 후 충돌해소</strong></p><p>긴 URL을 줄이려면, 원래 URL을 7글자 문자열로 줄이는 해시 함수가 필요하다. CRC32, MD5, SHA-1과 같이 잘 알려진 해시 함수를 이용하는것도 방법이다.</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>해시함수 | 해시 결과
CRC32    | 5cb54054
MD5     | 5a62509a84df9ee03fe1230b9df8b84e
SHA-1   | 0eeae7916c06853901d9ccbefbfcaf4de57ed85b
</pre></table></code></div></div><p>문제는 CRC32가 계산한 가장 짧은 해시조차도 단축URL의 길이인 7글자를 넘겨버린다.</p><p>이 문제를 해결할 첫 번째 방법은 7글자까지 그냥 잘라버리는 것이다.</p><p>이렇게 구현할 경우 해시 결과가 서로 충돌할 확률이 높아진다. 실제 충돌을 하면 충돌을 해소할 때까지 사전에 정한 문자열을 해시값에 덧붙이는 방법이 있다.</p><p><img data-src="https://user-images.githubusercontent.com/30401054/208027979-d2feb096-19be-4df4-8c36-b5a5df6e7100.png" alt="image" data-proofer-ignore></p><p>하지만 이렇게 하면 단축URL을 생성할 때 한 번 이상 데이터베이스에 질의해야하므로 오버헤드의 부담이 생긴다. 앞에서 배운 블룸 필터를 통해 공간 효율성을 증대시킬 수는 있지만 충돌을 피하기는 쉽지 않다는 것이다.</p><p><strong>base-62 변환</strong></p><p>진법 변환(base conversion)은 단축URL을 구성할 때 흔히 사용되는 접근법이다. 이 기법은 수의 표현 방식이 다른 두 시스템이 같은 수를 공유하여야 하는 경우에 유용하다. 62진법을 사용하는 이유는 이 예시에서 한 글자에 들어올 수 있는 문자의 경우의 수가 62이기 때문이다.</p><p>base-62 변환 예제이다. $ 11527_{10} $을 62진수로 변환해 보는 예제다.</p><ul><li>여기서 62진법은 이런식으로 구성되어 있다.</ul><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>0 ~ 9 : 0 ~ 9
a ~ z: 10 ~ 35
A ~ Z: 36 ~ 61
</pre></table></code></div></div><p>따라서 62진법에서 ‘a’는 $ 10<em>{10} $이고, ‘Z’는 $ 61</em>{10} $ 이다.</p><p><img data-src="https://user-images.githubusercontent.com/30401054/208028836-12f963e7-1236-485b-9fdb-405c1d33f4d0.png" alt="image" data-proofer-ignore></p><p>이러한 방식으로 $ 11157<em>{10} $의 62진법 변환은 $ 2TX</em>{62} $가 될 것이다.</p><p>두 접근법을 비교해 보겠다.</p><div class="table-wrapper"><table><thead><tr><th>해시 후 충돌 해소 전략<th>base-62 변환<tbody><tr><td>단축URL길이가 고정<td>단축URL길이가 가변, ID값이 커지면 같이 커진다.<tr><td>유일성이 필요한 ID 생성기가 필요 없음.<td>유일성 보장 ID가 필요함. 해시 중복 방지<tr><td>충돌이 가능해서 해소 전략필요<td>ID가 유일하면 충돌이 불가능<tr><td>ID로부터 도출해내는 방식이 아니라 다음에 쓸 URL을 알아내는것이 불가능<td>다음에쓸 단축URL을 알아낼 수 있어서 보안상의 문제가 있을 수 있다.</table></div><h3 id="url-단축기-상세-설계"><span class="mr-2">URL 단축기 상세 설계</span><a href="#url-단축기-상세-설계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>62진법 변환을 기준으로 설명 되어 있다.</p><p>처리 로직은 간단하다.</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>            입력으로 긴 원본URL을 받는다
                      |
                      |
                      |
                      |
              입력된 URL이 DB에 있나?
            ┌----------------------┐
        yes |                      | no
            |                      |
            |                      |
  DB에서 찾은 단축URL 변환        새로운 ID 생성
                                   |
                                   |
                                   |
                                   |
                            생성된 ID를 단축URL로 변환
                                   |
                                   |
                            ID, 단축 URL, 원래URL을 DB에 저장
</pre></table></code></div></div><p>ID생성기는 7장에서 구현하는 방법을 이야기 했다.</p><p><a href="https://kkminseok.github.io/posts/2022-12-15-interviewBook07/">참고</a></p><h3 id="url-리다이렉션-상세-설계"><span class="mr-2">URL 리다이렉션 상세 설계</span><a href="#url-리다이렉션-상세-설계" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="https://user-images.githubusercontent.com/30401054/208040782-ff259347-0878-4df5-a8cc-3e0bfa5c0286.png" alt="image" data-proofer-ignore></p><ol><li>사용자가 단축 URL을 클릭한다.<li>로드 밸런서가 해당 클릭으로 발생한 요청을 웹 서버에 전달한다.<li>단축URL이 이미 캐시에 있는 경우 원래 URL을 꺼내 반환한다.<li>단축URL이 캐시에 없는 경우 데이터베이스에서 꺼낸다. 만약 데이터가 없으면 사용자가 잘못된 단축URL을 입력한 것이다.<li>데이터베이스에서 꺼낸 URL을 캐시에 넣은 후 사용자에게 반환한다.</ol><hr /><h2 id="-정리"><span class="mr-2">🤔 정리</span><a href="#-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>단축URL이라는 시스템디자인을 이 책을 읽어보면서 처음 해보았다.</p><p>그렇게 어렵다고 느끼지는 않았고, 구현과정을 다시 되짚어볼 필요가 있음을 느꼈다.</p><p>API 설계, 데이터 모델 설계, 해시 함수 설계, URL 단축 및 리다이렉션 절차를 설계하였다.</p><p>추가적으로 고려해볼만한건 다음과 같은게 있다.</p><ul><li>처리율 제한 장치: 엄청난 양의 URL 단축 요청이 밀려 들어오면 시스템이 무력화 될 수도 있다. 처리율 제한 장치를 둬서 요청을 어느정도 걸러낼 수 있을 것이다.<li>본 설계는 무상태(stateless) 웹 계층을 가지고 있으므로 자유롭게 웹 서버를 증설하거나 삭제할 수 있다.<li>데이터베이스 규모 확장: 데이터베이스 다중화하거나 샤딩하여 규모 확장성을 달성할 수 있다.<li>데이터 분석 솔루션: 데이터를 통해 링크를 얼마나 많은 사용자가 클릭했는지, 언제 주로 클릭했는지 등 중요한 정보를 알아낼 수 있을 것이다.<li>가용성, 데이터 일관성, 안정성 적용에 대한 논의</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/book/'>Book</a>, <a href='/categories/%EA%B0%80%EC%83%81-%EB%A9%B4%EC%A0%91-%EC%82%AC%EB%A1%80%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8C%80%EA%B7%9C%EB%AA%A8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EA%B3%84-%EA%B8%B0%EC%B4%88/'>가상 면접 사례로 배우는 대규모 시스템 설계 기초</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/book/" class="post-tag no-text-decoration" >book</a> <a href="/tags/interview/" class="post-tag no-text-decoration" >interview</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - https://kkminseok.github.io/posts/2022-12-16-interViewBook08/ 단축기 설계 - 민석강&amp;url=https://kkminseok.github.io/posts/2022-12-16-interViewBook08/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - https://kkminseok.github.io/posts/2022-12-16-interViewBook08/ 단축기 설계 - 민석강&amp;u=https://kkminseok.github.io/posts/2022-12-16-interViewBook08/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://kkminseok.github.io/posts/2022-12-16-interViewBook08/&amp;text=가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - https://kkminseok.github.io/posts/2022-12-16-interViewBook08/ 단축기 설계 - 민석강" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/2023-03-06-dnd/">DND 8기 활동 후기</a><li><a href="/posts/2024-03-31-fastapi/">fastapi Swagger Response 분리하기</a><li><a href="/posts/2023-05-19-think01/">5월19일시점 개발하면서 고민한 것들 + 도커관련 이슈</a><li><a href="/posts/2023-05-02-Modern-Java-In-action/">2번 읽는 Modern Java In Action - Chapter06 스트림으로 데이터 수집</a><li><a href="/posts/2023-03-18-Modern-Java-In-Action/">2번 읽는 Modern Java In Action - Chapter01 기초</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/algorithmstudy/">AlgorithmStudy</a> <a class="post-tag" href="/tags/top100like/">Top100Like</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/fastapi/">FastAPI</a> <a class="post-tag" href="/tags/economy/">Economy</a> <a class="post-tag" href="/tags/dp/">DP</a> <a class="post-tag" href="/tags/top100interview/">Top100Interview</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/20221207InterviewBook01/"><div class="card-body"> <em class="timeago small" data-ts="1670346120" > 2022-12-07 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>가상 면접 사례로 배우는 대규모 시스템 설계 기초 1장 - 사용자 수에 따른 규모 확장성</h3><div class="text-muted small"><p> 가상 면접 사례로 배우는 대규모 시스템 설계 기초 책 정리 글입니다. 개요 원준이라는 친구가 나 공부 열심히하라고 책을 선물해줬다. 읽어보도록 했다. 1장은 한 명의 사용자를 지원하는 시스템에서 시작한다. ✏️ 단일 서버 웹브라우저, 웹 서버, DNS가 있을때 사용자의 요청 (웹 브라우저에서 요청을 보냄)이 어떻게 처리되는지를 알...</p></div></div></a></div><div class="card"> <a href="/posts/20221208InterviewBook02/"><div class="card-body"> <em class="timeago small" data-ts="1670432520" > 2022-12-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>가상 면접 사례로 배우는 대규모 시스템 설계 기초 2장 - 개략적인 규모 추정</h3><div class="text-muted small"><p> 가상 면접 사례로 배우는 대규모 시스템 설계 기초 책 정리 글입니다. 개요 이 장은 시스템 용량이나 성능 요구사항을 개략적으로 측정하는 방법에 대해 다룬다. 개략적 규모 추정을 효과적으로 필요한 기본기에 능숙해야 한다. 특히, 2의 제곱수나 응답지연(latency) 값, 그리고 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 한다고...</p></div></div></a></div><div class="card"> <a href="/posts/2022-12-09-InterviewBoo03/"><div class="card-body"> <em class="timeago small" data-ts="1670515320" > 2022-12-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>가상 면접 사례로 배우는 대규모 시스템 설계 기초 3장 - 시스템 설계 면접 공략법</h3><div class="text-muted small"><p> 가상 면접 사례로 배우는 대규모 시스템 설계 기초 책 정리 글입니다. 개요 시스템 설계 면접은 두 명의 동료가 모호한 문제를 풀기 위해 협력하여 해결책을 찾아가는 과정이다. 때문에 정답도 없고 결과도 없다. 설계과정에서 내린 결정에 대해 방어하는 능력을 보는 과정이고, 면접관의 피드백을 건설적인 방향으로 처리할 자질이 있음을 보는 면접이다....</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/2022-12-15-Spring_WebMVCTest/" class="btn btn-outline-primary" prompt="Older"><p>SpringMVC - MockMvc, @WebMvcTest코드까보기</p></a> <a href="/posts/2022-12-25TIL/" class="btn btn-outline-primary" prompt="Newer"><p>Java,OS- 동시성 정리</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "kkminseok/kkminseok.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnkzNDUwNzI2OTM=", "data-category": "Announcements", "data-category-id": "DIC_kwDOFJFkNc4CO5-J", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/none">kang minseok</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/algorithmstudy/">AlgorithmStudy</a> <a class="post-tag" href="/tags/top100like/">Top100Like</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/fastapi/">FastAPI</a> <a class="post-tag" href="/tags/economy/">Economy</a> <a class="post-tag" href="/tags/dp/">DP</a> <a class="post-tag" href="/tags/top100interview/">Top100Interview</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KMXXJ0D586"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KMXXJ0D586'); }); </script>
