<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="SpringMVC - MockMvc, @WebMvcTest코드까보기" /><meta name="author" content="minseok" /><meta property="og:locale" content="ko" /><meta name="description" content="real-world project 구현 과정 카테고리 보기" /><meta property="og:description" content="real-world project 구현 과정 카테고리 보기" /><link rel="canonical" href="https://kkminseok.github.io/posts/2022-12-15-Spring_WebMVCTest/" /><meta property="og:url" content="https://kkminseok.github.io/posts/2022-12-15-Spring_WebMVCTest/" /><meta property="og:site_name" content="민석강" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-15T02:02:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SpringMVC - MockMvc, @WebMvcTest코드까보기" /><meta name="twitter:site" content="@none" /><meta name="twitter:creator" content="@minseok" /><meta name="google-site-verification" content="_icgy_j24DLYroQvKYTiffcqemP7ldWCxmrM2cGtYck" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"minseok"},"dateModified":"2023-01-08T23:47:01+09:00","datePublished":"2022-12-15T02:02:00+09:00","description":"real-world project 구현 과정 카테고리 보기","headline":"SpringMVC - MockMvc, @WebMvcTest코드까보기","mainEntityOfPage":{"@type":"WebPage","@id":"https://kkminseok.github.io/posts/2022-12-15-Spring_WebMVCTest/"},"url":"https://kkminseok.github.io/posts/2022-12-15-Spring_WebMVCTest/"}</script><title>SpringMVC - MockMvc, @WebMvcTest코드까보기 | 민석강</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="민석강"><meta name="application-name" content="민석강"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/sample/logo.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">민석강</a></div><div class="site-subtitle font-italic">3년차 개발자. 40살에 100억벌고 은퇴</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kkminseok" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/none" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['minseok19950727','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>SpringMVC - MockMvc, @WebMvcTest코드까보기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>SpringMVC - MockMvc, @WebMvcTest코드까보기</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/kkminseok">minseok</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1671037320" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-12-15 </em> </span> <span> Updated <em class="timeago" data-ts="1673189221" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-01-08 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1562 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><blockquote class="prompt-info"><div><p><a href="https://kkminseok.github.io/categories/real-world-spring/">real-world project 구현 과정 카테고리 보기</a></p></div></blockquote><h1 id="개요">개요</h1><p>테스트 코드를 짜면서 어쩌다보니 쓰고 있는 이 클래스, 어노테이션들 정리할 필요를 느꼈다.</p><h2 id="-mockmvc-webmvctest"><span class="mr-2">😎 MockMvc, @WebMvcTest</span><a href="#-mockmvc-webmvctest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><code class="language-plaintext highlighter-rouge">@WebMvcTest</code>어노테이션을 알기 전 <code class="language-plaintext highlighter-rouge">MockMvc</code>에 대해 알고 있어야한다. <code class="language-plaintext highlighter-rouge">@WebMvcTest</code> 문서를 보면 <code class="language-plaintext highlighter-rouge">MockMvc</code>에 대한 언급이 나오기 때문이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@WebMvcTest</span><span class="o">(</span><span class="n">controllers</span> <span class="o">=</span> <span class="nc">UsersController</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">UsersControllerTest</span> <span class="o">{</span>

    <span class="kt">void</span> <span class="nf">signup</span><span class="o">(</span><span class="nc">UserSignupRequest</span> <span class="n">userSignupRequest</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nd">@Autowired</span>
        <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

        <span class="o">...</span>
        <span class="c1">//when , then</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/api/users"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">objectMapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">userSignupRequest</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">())</span>
                <span class="o">)</span>

        <span class="o">...</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이런식으로 사용하고 있는 mockMvc</p><p>mockMvc는 컨트롤러에 가짜 HTTP요청을 보낸다.</p><p>Spring은 <code class="language-plaintext highlighter-rouge">DispatcherServlet</code>이라는 실제 웹 요청을 처리하는 서블릿을 가지고 있는데 mockMvc는 <code class="language-plaintext highlighter-rouge">DispatcherServlet</code>을 모방하여 요청을 보낸다.</p><p>이러한 가짜 서블릿을 통해 실제 웹 서버가 뜨지 않고도 컨트롤러에 요청을 보낼 수 있어서 테스트가 가능하다.</p><p>단점으로는 실제 웹 서버와 다르게 동작할 수 있어서 정확한 테스트가 어려울 수도 있다는 것이다.</p><p>죽 mockMvc는</p><ol><li>컨트롤러와 관련된 정보를 가지고 가짜 HTTP 요청 생성을 한다.<li>가짜 HTTP 요청을 컨트롤러에 전달한다. 이 요청은 <code class="language-plaintext highlighter-rouge">DispatcherServlet</code>을 모방한 방식대로 처리됨. 요청한 컨트롤러를 찾고, 요청을 전달한다.<li>컨트롤러의 응답을 검증한다. 이는 <code class="language-plaintext highlighter-rouge">.andExpect()</code>같은 함수를 통해 검증이 가능하다.</ol><p>그러면 MockMvc는 어떻게 가짜 servlet을 만들 수 있는걸까?</p><p>그러면 다시 <code class="language-plaintext highlighter-rouge">@WebMvcTest</code>에 대해 간단히 언급해야한다.</p><p>이는 <code class="language-plaintext highlighter-rouge">@SpringBootApplication</code>가 자동설정을 도와주듯 해당 어노테이션도 테스트에 필요한 설정들을 자동화해준다고 현재는 이해하자.</p><p>아무튼 <code class="language-plaintext highlighter-rouge">@WebMvcTest</code> 코드를 보면</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="nd">@ConditionalOnMissingBean</span>
<span class="kd">public</span> <span class="nc">MockMvc</span> <span class="nf">mockMvc</span><span class="o">(</span><span class="nc">MockMvcBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>@ConditionalOnMissingBean는 이미 등록된 빈이 없을때 새로 만들어준다는 코드</p></blockquote><p>라는 코드가 있다. 빈으로 등록하는 코드이다. 파라미터로 들어온 builder에는 웹 컨텍스트의 정보가 들어있다고 알고 있자.</p><p>아무튼 MockMvc 빈을 생성할 때 빌더패턴을 통해 빌드를 하게 되는 것 같다. 그래서 해당 코드로 또 들어가보면</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="nd">@Override</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="nc">MockMvc</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">WebApplicationContext</span> <span class="n">wac</span> <span class="o">=</span> <span class="n">initWebAppContext</span><span class="o">();</span>
    <span class="nc">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">wac</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
    <span class="nc">MockServletConfig</span> <span class="n">mockServletConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MockServletConfig</span><span class="o">(</span><span class="n">servletContext</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="nc">MockMvcConfigurer</span> <span class="n">configurer</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">configurers</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">RequestPostProcessor</span> <span class="n">processor</span> <span class="o">=</span> <span class="n">configurer</span><span class="o">.</span><span class="na">beforeMockMvcCreated</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">wac</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">processor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">defaultRequestBuilder</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">defaultRequestBuilder</span> <span class="o">=</span> <span class="nc">MockMvcRequestBuilders</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">defaultRequestBuilder</span> <span class="k">instanceof</span> <span class="nc">ConfigurableSmartRequestBuilder</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">((</span><span class="nc">ConfigurableSmartRequestBuilder</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">defaultRequestBuilder</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="n">processor</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nc">Filter</span><span class="o">[]</span> <span class="n">filterArray</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">filters</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">Filter</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>

    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">createMockMvc</span><span class="o">(</span><span class="n">filterArray</span><span class="o">,</span> <span class="n">mockServletConfig</span><span class="o">,</span> <span class="n">wac</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">defaultRequestBuilder</span><span class="o">,</span>
            <span class="k">this</span><span class="o">.</span><span class="na">defaultResponseCharacterEncoding</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">globalResultMatchers</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">globalResultHandlers</span><span class="o">,</span>
            <span class="k">this</span><span class="o">.</span><span class="na">dispatcherServletCustomizers</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>요약하자면 테스트용 서블릿 컨텍스트가 있는데, 이에 저장된 필터, 설정들을 실제 서블릿 컨텍스트에 넣는다.</p><p>그리고 <code class="language-plaintext highlighter-rouge">createMockMvc()</code>을 리턴하기에 이 코드도 까봐야한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kd">protected</span> <span class="kd">final</span> <span class="nc">MockMvc</span> <span class="nf">createMockMvc</span><span class="o">(</span><span class="nc">Filter</span><span class="o">[]</span> <span class="n">filters</span><span class="o">,</span> <span class="nc">MockServletConfig</span> <span class="n">servletConfig</span><span class="o">,</span>
        <span class="nc">WebApplicationContext</span> <span class="n">webAppContext</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">RequestBuilder</span> <span class="n">defaultRequestBuilder</span><span class="o">,</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ResultMatcher</span><span class="o">&gt;</span> <span class="n">globalResultMatchers</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ResultHandler</span><span class="o">&gt;</span> <span class="n">globalResultHandlers</span><span class="o">,</span>
        <span class="nd">@Nullable</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">DispatcherServletCustomizer</span><span class="o">&gt;</span> <span class="n">dispatcherServletCustomizers</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">TestDispatcherServlet</span> <span class="n">dispatcherServlet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestDispatcherServlet</span><span class="o">(</span><span class="n">webAppContext</span><span class="o">);</span>
    
    <span class="o">...</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">dispatcherServlet</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">servletConfig</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">ServletException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// should never happen..</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">MockMvcBuildException</span><span class="o">(</span><span class="s">"Failed to initialize TestDispatcherServlet"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">MockMvc</span> <span class="n">mockMvc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MockMvc</span><span class="o">(</span><span class="n">dispatcherServlet</span><span class="o">,</span> <span class="n">filters</span><span class="o">);</span>
    <span class="n">mockMvc</span><span class="o">.</span><span class="na">setDefaultRequest</span><span class="o">(</span><span class="n">defaultRequestBuilder</span><span class="o">);</span>
    <span class="n">mockMvc</span><span class="o">.</span><span class="na">setGlobalResultMatchers</span><span class="o">(</span><span class="n">globalResultMatchers</span><span class="o">);</span>
    <span class="n">mockMvc</span><span class="o">.</span><span class="na">setGlobalResultHandlers</span><span class="o">(</span><span class="n">globalResultHandlers</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">mockMvc</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>보아하니, 테스트용 DispatcherServlet을 만들고 MockMvc객체를 생성할 때 넣는다.</p><p><code class="language-plaintext highlighter-rouge">new MockMvc(dispatcherServlet, filters)</code>을 보면</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nc">MockMvc</span><span class="o">(</span><span class="nc">TestDispatcherServlet</span> <span class="n">servlet</span><span class="o">,</span> <span class="nc">Filter</span><span class="o">...</span> <span class="n">filters</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">servlet</span><span class="o">,</span> <span class="s">"DispatcherServlet is required"</span><span class="o">);</span>
    <span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">filters</span><span class="o">,</span> <span class="s">"Filters cannot be null"</span><span class="o">);</span>
    <span class="nc">Assert</span><span class="o">.</span><span class="na">noNullElements</span><span class="o">(</span><span class="n">filters</span><span class="o">,</span> <span class="s">"Filters cannot contain null values"</span><span class="o">);</span>

    <span class="k">this</span><span class="o">.</span><span class="na">servlet</span> <span class="o">=</span> <span class="n">servlet</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">servletContext</span> <span class="o">=</span> <span class="n">servlet</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 되어있다. 즉, MockMvc는 빈에 등록되어있고, 테스트용 <code class="language-plaintext highlighter-rouge">DispatcherServlet</code>과 설정값들을 가지고 있다.</p><p>그러면 실제 MockMvc인스턴스의 함수를 호출하는 곳을 보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/api/users"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">objectMapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">userSignupRequest</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">())</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="nc">MockMvcResultMatchers</span><span class="o">.</span><span class="na">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
</pre></table></code></div></div><p>이렇게 구현해놨는데, <code class="language-plaintext highlighter-rouge">.perform()</code>은 어떻게 수행되는걸까??</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">ResultActions</span> <span class="nf">perform</span><span class="o">(</span><span class="nc">RequestBuilder</span> <span class="n">requestBuilder</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="o">...</span>

        <span class="c1">//1. 테스트용 HttpServletRequest 객체에 값을 넣음.</span>
		<span class="nc">MockHttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">requestBuilder</span><span class="o">.</span><span class="na">buildRequest</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">servletContext</span><span class="o">);</span>

        <span class="c1">//2. 비동기 서블릿 컨텍스트 호출 =&gt; null</span>
		<span class="nc">AsyncContext</span> <span class="n">asyncContext</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getAsyncContext</span><span class="o">();</span>
		<span class="nc">MockHttpServletResponse</span> <span class="n">mockResponse</span><span class="o">;</span>
		<span class="nc">HttpServletResponse</span> <span class="n">servletResponse</span><span class="o">;</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">asyncContext</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">...</span>
		<span class="o">}</span>
        <span class="c1">//3. null이므로 새로운 테스트용 HttpServletResponse 객체를 만듦. 이때는 빈 값이다. status도 200이고 response의 내용물은 비어있다.</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="n">mockResponse</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MockHttpServletResponse</span><span class="o">();</span>
			<span class="n">servletResponse</span> <span class="o">=</span> <span class="n">mockResponse</span><span class="o">;</span>
		<span class="o">}</span>

		
        <span class="c1">//4. 인풋 헤더를 검증하는 부분같은데 잘 이해 못했습니다.</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">requestBuilder</span> <span class="k">instanceof</span> <span class="nc">SmartRequestBuilder</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">request</span> <span class="o">=</span> <span class="o">((</span><span class="nc">SmartRequestBuilder</span><span class="o">)</span> <span class="n">requestBuilder</span><span class="o">).</span><span class="na">postProcessRequest</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
		<span class="o">}</span>

        <span class="c1">//5. mvcResult는 mockRequest,와 mockResponse를 가지고 있다.</span>
		<span class="nc">MvcResult</span> <span class="n">mvcResult</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultMvcResult</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">mockResponse</span><span class="o">);</span>
        <span class="c1">//6. 리퀘스트 속성에 이값을 키-값 형태로 넣는다.</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">MVC_RESULT_ATTRIBUTE</span><span class="o">,</span> <span class="n">mvcResult</span><span class="o">);</span>

        <span class="o">...</span>

		
        <span class="c1">//7. 테스트용 필터를 생성하는데, 이 값에는 기본 필터들과 사용자가 정의한 필터(Jwt 관련)가 들어있다. 또한 인자로 들어간 테스트용 서블릿객체도 들어가 있다.</span>
		<span class="nc">MockFilterChain</span> <span class="n">filterChain</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MockFilterChain</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">servlet</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">filters</span><span class="o">);</span>
        <span class="c1">//8. 실질적으로 요청을 보내는 부분이다. 들어온 필터를 도는데 결국 마지막에 들어간 서블릿객체의 service()도 호출하여 실질적으로 가짜HTTP요청이 MockMvc가 만든 서블릿객체에 들어간다.</span>
		<span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>

        <span class="o">...</span>

        <span class="c1">//9. 결국 요청에 대한 응답을 받는다.</span>
		<span class="n">applyDefaultResultActions</span><span class="o">(</span><span class="n">mvcResult</span><span class="o">);</span>
		<span class="nc">RequestContextHolder</span><span class="o">.</span><span class="na">setRequestAttributes</span><span class="o">(</span><span class="n">previousAttributes</span><span class="o">);</span>

        <span class="c1">//10. andExpect()처럼 후처리.</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">ResultActions</span><span class="o">()</span> <span class="o">{</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="nc">ResultActions</span> <span class="nf">andExpect</span><span class="o">(</span><span class="nc">ResultMatcher</span> <span class="n">matcher</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
				<span class="n">matcher</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">mvcResult</span><span class="o">);</span>
				<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="nc">ResultActions</span> <span class="nf">andDo</span><span class="o">(</span><span class="nc">ResultHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
				<span class="n">handler</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">mvcResult</span><span class="o">);</span>
				<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="nc">MvcResult</span> <span class="nf">andReturn</span><span class="o">()</span> <span class="o">{</span>
				<span class="k">return</span> <span class="n">mvcResult</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">};</span>
	<span class="o">}</span>
</pre></table></code></div></div><p>참고로</p><p>파라미터로 들어온 <code class="language-plaintext highlighter-rouge">requestBuilder</code>는 이런식으로 저장되어있다.</p><p><img data-src="https://user-images.githubusercontent.com/30401054/207798619-420c749c-0b0e-4438-93c8-efd8f2ecd121.png" alt="image" data-proofer-ignore></p><hr /><p>쓰다말다 쓰다말다해서 내용이 좀 난잡하다. 참고만 해야할것 같다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a>, <a href='/categories/spring/'>Spring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SpringMVC - MockMvc, @WebMvcTest코드까보기 - 민석강&amp;url=https://kkminseok.github.io/posts/2022-12-15-Spring_WebMVCTest/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SpringMVC - MockMvc, @WebMvcTest코드까보기 - 민석강&amp;u=https://kkminseok.github.io/posts/2022-12-15-Spring_WebMVCTest/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://kkminseok.github.io/posts/2022-12-15-Spring_WebMVCTest/&amp;text=SpringMVC - MockMvc, @WebMvcTest코드까보기 - 민석강" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/2023-03-06-dnd/">DND 8기 활동 후기</a><li><a href="/posts/2024-03-31-fastapi/">fastapi Swagger Response 분리하기</a><li><a href="/posts/2023-05-19-think01/">5월19일시점 개발하면서 고민한 것들 + 도커관련 이슈</a><li><a href="/posts/2023-05-02-Modern-Java-In-action/">2번 읽는 Modern Java In Action - Chapter06 스트림으로 데이터 수집</a><li><a href="/posts/2023-03-18-Modern-Java-In-Action/">2번 읽는 Modern Java In Action - Chapter01 기초</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/algorithmstudy/">AlgorithmStudy</a> <a class="post-tag" href="/tags/top100like/">Top100Like</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/fastapi/">FastAPI</a> <a class="post-tag" href="/tags/economy/">Economy</a> <a class="post-tag" href="/tags/dp/">DP</a> <a class="post-tag" href="/tags/top100interview/">Top100Interview</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/TIL0928/"><div class="card-body"> <em class="timeago small" data-ts="1664294520" > 2022-09-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>면접준비 - Java JVM(1)</h3><div class="text-muted small"><p> 오타, 지적 환영입니다. JVM 이란 무엇인가? JVM은 JAVA Virtual Machine의 약자. 자바 가상 머신이란 뜻이다. 가상 머신은 프로그램 실행 등을 위해 물리적 머신과 비슷하게 소프트웨어로 구현한 것이다. JVM의 목적은 클래스 로더를 통해 자바API와 함께 자바 애플리케이션을 실행하는 것. JVM은 OS와 JA...</p></div></div></a></div><div class="card"> <a href="/posts/TIL0929/"><div class="card-body"> <em class="timeago small" data-ts="1664294520" > 2022-09-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>면접준비 - Java 오버로딩, 오버라이딩</h3><div class="text-muted small"><p> 오타, 지적 환영입니다. 메소드 시그니처(method signature) 오버로딩, 오버라이딩을 공부하기 전에 메소드 시그니처에 대해 알아야한다. 메소드 시그니처란 메소드의 선언부에 명시되어 있는 매개변수의 리스트다. 나는 파라미터가 더 이해하기 편해서 파라미터라 하겠다. 다음 조건을 만족시 같은 시그니처를 갖는다 메소드 이름 ...</p></div></div></a></div><div class="card"> <a href="/posts/1001TIL/"><div class="card-body"> <em class="timeago small" data-ts="1664557320" > 2022-10-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>면접준비 - Java 동등성, 동일성</h3><div class="text-muted small"><p> 오타, 지적 환영입니다. A라는 객체와 B라는 객체가 있다고 치자. 한줄로 요약해서 동일성은 A와 B의 메모리 주소가 같은 경우이고, 동등성은 둘이 다른 메모리를 가리킬지라도 저장된 정보는 같은 경우를 말한다. ✍️동등성 String A = new String(&quot;안녕하세요?&quot;); String B = A; System...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/2022-12-15-interviewBook07/" class="btn btn-outline-primary" prompt="Older"><p>가상 면접 사례로 배우는 대규모 시스템 설계 기초 7장 - 분산 시스템을 위한 유일 ID 생성기 설계</p></a> <a href="/posts/2022-12-16-interViewBook08/" class="btn btn-outline-primary" prompt="Newer"><p>가상 면접 사례로 배우는 대규모 시스템 설계 기초 8장 - URL 단축기 설계</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "kkminseok/kkminseok.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnkzNDUwNzI2OTM=", "data-category": "Announcements", "data-category-id": "DIC_kwDOFJFkNc4CO5-J", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/none">kang minseok</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/algorithmstudy/">AlgorithmStudy</a> <a class="post-tag" href="/tags/top100like/">Top100Like</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/fastapi/">FastAPI</a> <a class="post-tag" href="/tags/economy/">Economy</a> <a class="post-tag" href="/tags/dp/">DP</a> <a class="post-tag" href="/tags/top100interview/">Top100Interview</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KMXXJ0D586"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KMXXJ0D586'); }); </script>
