<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기" /><meta name="author" content="minseok" /><meta property="og:locale" content="ko" /><meta name="description" content="real-world project 구현 과정 카테고리 보기" /><meta property="og:description" content="real-world project 구현 과정 카테고리 보기" /><link rel="canonical" href="https://kkminseok.github.io/posts/realworld05/" /><meta property="og:url" content="https://kkminseok.github.io/posts/realworld05/" /><meta property="og:site_name" content="민석강" /><meta property="og:image" content="https://kkminseok.github.io/assets/img/realworld/realworldLogo.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-12T00:02:00+09:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://kkminseok.github.io/assets/img/realworld/realworldLogo.png" /><meta property="twitter:title" content="real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기" /><meta name="twitter:site" content="@none" /><meta name="twitter:creator" content="@minseok" /><meta name="google-site-verification" content="_icgy_j24DLYroQvKYTiffcqemP7ldWCxmrM2cGtYck" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"minseok"},"dateModified":"2022-12-07T16:11:38+09:00","datePublished":"2022-10-12T00:02:00+09:00","description":"real-world project 구현 과정 카테고리 보기","headline":"real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기","image":"https://kkminseok.github.io/assets/img/realworld/realworldLogo.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://kkminseok.github.io/posts/realworld05/"},"url":"https://kkminseok.github.io/posts/realworld05/"}</script><title>real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기 | 민석강</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="민석강"><meta name="application-name" content="민석강"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/sample/logo.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">민석강</a></div><div class="site-subtitle font-italic">3년차 개발자. 40살에 100억벌고 은퇴</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/kkminseok" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/none" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['minseok19950727','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/kkminseok">minseok</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1665500520" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-10-12 </em> </span> <span> Updated <em class="timeago" data-ts="1670397098" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-12-07 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2972 words"> <em>16 min</em> read</span></div></div></div><div class="post-content"><blockquote class="prompt-info"><div><p><a href="https://kkminseok.github.io/categories/real-world-spring/">real-world project 구현 과정 카테고리 보기</a></p></div></blockquote><h2 id="코드"><span class="mr-2">코드</span><a href="#코드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.io.realworld.security</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">com.io.realworld.security.jwt.JwtAuthenticationFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.RequiredArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.web.SecurityFilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.web.authentication.HttpStatusEntryPoint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtAuthenticationFilter</span> <span class="n">jwtAuthenticationFilter</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BCryptPasswordEncoder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">WebSecurityCustomizer</span> <span class="nf">configure</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">web</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">web</span><span class="o">.</span><span class="na">ignoring</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/h2-console/**"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span><span class="o">.</span><span class="na">csrf</span><span class="o">()</span>
                <span class="o">.</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/api/users/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
                <span class="o">.</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">().</span><span class="na">authenticationEntryPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpStatusEntryPoint</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">UNAUTHORIZED</span><span class="o">))</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">addFilterBefore</span><span class="o">(</span><span class="n">jwtAuthenticationFilter</span><span class="o">,</span> <span class="nc">UsernamePasswordAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><p>이 코드를 분석해볼 것이다.</p><h2 id="enablewebsecurity"><span class="mr-2">@EnableWebSecurity</span><a href="#enablewebsecurity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><code class="language-plaintext highlighter-rouge">@EnableWebSecurity</code>와 <code class="language-plaintext highlighter-rouge">@Configuration</code>을 통해서 Spring Security 설정할 클래스라고 정의를 한다.</p><p>보통 <code class="language-plaintext highlighter-rouge">WebSebSecurityConfigurerAdapter</code>을 상속받아서 구현하는데, 현재 필자 버전에서는 WebSebSecurityConfigurerAdapter가 Deprecate되어버려서 직접 필요한것들은 빈으로 생성해야한다.</p><p>원래는 여러 configure()함수를 오버라이딩 해주면서 설정을 해줘야했지만 그런것들이 사라졌다.</p><p>참고로 Spring boot를 사용하면 해당 어노테이션은 자동으로 세팅되므로 따로 적어주지 않아도 된다길래 나도 지웠다.</p><h2 id="requiredargsconstructor"><span class="mr-2">@RequiredArgsConstructor</span><a href="#requiredargsconstructor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>롬복 어노테이션으로 초기화되지 않은 <code class="language-plaintext highlighter-rouge">final</code>필드나 <code class="language-plaintext highlighter-rouge">@NonNull</code>이 붙은 필드에 대해 생성자를 생성해준다. 이를 통해 JWT관련 필터 클래스를 초기화해준다.</p><h2 id="bcryptpasswordencoder"><span class="mr-2"><strong>BCryptPasswordEncoder</strong></span><a href="#bcryptpasswordencoder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>BCrypt라는 해시 알고리즘을 통해 암호화인코더를 구현한 클래스다.</p><p>BCrypy는 반복된 brute-force에도 잘 대응하고 가장 강력한 해시 메커니즘 중 하나라고 한다.</p><p>회원가입할 때 패스워드를 암호화해줘야하므로 이것을 Bean으로 등록해준다.</p><h2 id="configure함수"><span class="mr-2"><strong>configure()함수</strong></span><a href="#configure함수" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">WebSecurityCustomizer</span> <span class="nf">configure</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">web</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">web</span><span class="o">.</span><span class="na">ignoring</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/h2-console/**"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">WebSecurityCustomizer</code>는 <code class="language-plaintext highlighter-rouge">@FunctionalInterface</code>어노테이션이 붙어 있어서 람다표현식을 사용하여 작성해야한다.</p><p><code class="language-plaintext highlighter-rouge">WebSecurity</code> 클래스를 커스터마이징하여 이를 반환해야한다.</p><p>위의 문법을 통해 <code class="language-plaintext highlighter-rouge">h2-console</code>로 들어오는 모든 요청에 대해 인증 필터를 안 타게 해준다.</p><p>이는 예전 WebSecurity 설정을 해주는것과 동일하다.</p><h2 id="filterchain함수"><span class="mr-2"><strong>filterChain()함수</strong></span><a href="#filterchain함수" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>위가 예전 WebSecurity 설정을 하는거라면 이함수의 리턴타입은 HttpSecurity 설정을 하는것과 동일하다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">http</span><span class="o">.</span><span class="na">csrf</span><span class="o">()</span>
            <span class="o">.</span><span class="na">disable</span><span class="o">()</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/api/users/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
            <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
            <span class="o">.</span><span class="na">disable</span><span class="o">()</span>
            <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">().</span><span class="na">authenticationEntryPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpStatusEntryPoint</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">UNAUTHORIZED</span><span class="o">))</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">addFilterBefore</span><span class="o">(</span><span class="n">jwtAuthenticationFilter</span><span class="o">,</span> <span class="nc">UsernamePasswordAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>코드를 보면 <code class="language-plaintext highlighter-rouge">antMatchers()</code>라는 함수가 똑같이 쓰인다. 그러면 여기서 반환하는 HttpSecurity와 WebSecurity의 차이점은 뭘까??</p><h3 id="httpsecurity-vs-websecurity"><span class="mr-2"><strong>HttpSecurity vs WebSecurity</strong></span><a href="#httpsecurity-vs-websecurity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>stackoverflow 글을 보면 WebSecurtiy로 설정하면 스프링 시큐리티가 제공하는 다른 기능들도 무시하면서 요청을 받을 수 있다. 예를들면 스프링 시큐리티 컨텍스트를 사용하지 못한다. 그리고 저 코드에서 <code class="language-plaintext highlighter-rouge">/h2-console</code> url을 기준으로 해당 url로 요청으로 들어왔을때 XSS 어택, 스니핑, Cross-Site-Scripting과 같은 공격에 방어할 수 없다.</p><p>그러면 HttpSecurity는 스프링 시큐리티가 제공하는 기능들을 쓸 수 있어서 위와 같은 공격에 대응이 가능하다. HttpSecurity로 설정한 것들은 인증에 대해서 무시하는것이고, 필터는 다 거치기에 필터를 거치는 비용이 있을 수 밖에 없다.</p><p>그렇기에 WebSecurity에 등록하는 것들은 보통 이미지나, js파일과 같은 인증/인가 정보가 필요없는 것들을 등록하고 사용한다고 한다.</p><h2 id="문법설명"><span class="mr-2"><strong>문법설명</strong></span><a href="#문법설명" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>함수들을 설명했으니 함수 안에 있는 것들이 어떤것을 나타내는지 알아볼 것이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">http</span><span class="o">.</span><span class="na">csrf</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="o">.</span><span class="na">disable</span><span class="o">()</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span> <span class="o">-</span> <span class="mi">3</span> 
    <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/api/users/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span> <span class="o">-</span> <span class="mi">4</span>
    <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span> <span class="o">-</span> <span class="mi">5</span>
    <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="o">-</span><span class="mi">6</span>
    <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span> <span class="o">-</span> <span class="mi">7</span>
    <span class="o">.</span><span class="na">disable</span><span class="o">()</span> <span class="o">-</span> <span class="mi">8</span>
    <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">().</span><span class="na">authenticationEntryPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpStatusEntryPoint</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">UNAUTHORIZED</span><span class="o">))</span> <span class="o">-</span> <span class="mi">9</span>
    <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="o">.</span><span class="na">addFilterBefore</span><span class="o">(</span><span class="n">jwtAuthenticationFilter</span><span class="o">,</span> <span class="nc">UsernamePasswordAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="o">-</span> <span class="mi">11</span>

    <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span> <span class="o">-</span> <span class="mi">12</span>
</pre></table></code></div></div><ul><li>1, 2 : csrf().disable()란 csrf()란 것을 사용하지 않겠다는 것인데, <strong>CSRF</strong>라는 것에 대해 알고 있어야한다.</ul><p><strong>CSRF</strong>란 세션과 쿠키의 특징을 이용한 공격방법인데, 사용자가 로그인이나 요청을 보냈을 경우 서버에서 sessionID를 주고 이를 사용자 쿠키에 저장하게 되는데, 공격자가 악성 스크립트를 누르도록 유도하여 사용자 브라우저에 저장 되어있는 sessionID를 이용하여 서버에 요청을 보내는 것이다. 서버는 sessionID를 통해 정상 사용자로 판단하고 요청을 처리하게 된다.</p><p>보통 stateless한 RestAPI에서는 쿠키나 세션을 사용하지 않고, 이 프로젝트도 <code class="language-plaintext highlighter-rouge">JWT</code>토큰을 사용하기에 csrf보호가 따로 필요없어서 disable처리를 했다.</p><p>그렇다해서 이를 따로 명시해주지 않는다면 Spring Security는 자동으로 <strong>csrf</strong>보호를 하기 때문에 어떤 요청에서도 <strong>csrf</strong>토큰이 포함되지 않아서 <strong>401 Unauthorized</strong> 상태를 반환할 것이다.</p><p><img data-src="/assets/img/realworld/05/csrf.png" alt="" data-proofer-ignore></p><p>csrf를 직접 생성하여 해결하는 방법은 <a href="https://zzang9ha.tistory.com/341">이 블로그</a>를 참조하면 좋다.</p><ul><li><p>3, 4 : <code class="language-plaintext highlighter-rouge">authorizeRequests()</code>는 HttpServletRequest에 따라 접근을 제한한다는 의미이다. 뒤에 있는 문법들이 제한하는것을 도와줄 것이다. <code class="language-plaintext highlighter-rouge">antMatchers(url).permitAll()</code>은 적힌 url에 들어오는 요청에 대해서는 아무 인가된 사용자가 아니여도 접근이 가능하게 지정한다. 참고로 url뿐만 아니라 Http Method도 적어줄 수 있고 혼용하여 사용할 수 있다.</p><li><p>5 : <code class="language-plaintext highlighter-rouge">antMatchers().permitAll()</code>는 어떤 요청에 대해서도 인증된 사용자만 접근허용하도록 한다는 제한을 건다.</p></ul><blockquote class="prompt-tip"><div><p>혼자 궁금해서 <code class="language-plaintext highlighter-rouge">antMatchers().permitAll()</code>와 <code class="language-plaintext highlighter-rouge">anyRequest().authenticated()</code>의 순서를 바꿔서 써봤다. 우선순위가 antMatchers 먼저일까 anyRequest가 먼저일까 궁금해졌기 때문이다. 결과는 에러가 발생한다. 그리고 친절하게 알려준다. <strong>antMatchers는 anyRequest뒤에 나올 수 없단다.</strong></p></div></blockquote><p><img data-src="/assets/img/realworld/05/anyRequest_antMatchers.png" alt="anyRequest error" data-proofer-ignore></p><ul><li><p>6 : and()는 상위 메소드들을 연결하기 위해 필요한 연결점이라고 생각하면 된다.</p><li><p>7,8 : 사용자 정의 로그인 기능과 로그아웃 기능을 가진 상위 메소드라는데, <code class="language-plaintext highlighter-rouge">loginPage(url)</code>처럼 login페이지 경로를 알려줄 수도 있고 로그인에 실패했을때 페이지, 성공했을때 페이지를 따로 또 지정해줄 수 있다. 이 기능말고 다양한 기능을 수행한다. 또한 보안 검증을 <strong>form</strong>기반으로 할 것이라고 하는데, 이 프로젝트에서는 그러지 않으므로 disable처리를 해주었다.</p><li><p>9 : <code class="language-plaintext highlighter-rouge">exceptionHandling()</code>는 예외가 발생했을때 핸들링할 수 있게 도와준다. 이 놈은 <code class="language-plaintext highlighter-rouge">ExceptionHandlingConfigurer</code>를 받아야하고, 이를 만들기 위해서는 <code class="language-plaintext highlighter-rouge">authenticationEntryPoint()</code>함수를 사용한다.</p></ul><p>이 함수의 구현을 보면</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">ExceptionHandlingConfigurer</span><span class="o">&lt;</span><span class="no">H</span><span class="o">&gt;</span> <span class="nf">authenticationEntryPoint</span><span class="o">(</span><span class="nc">AuthenticationEntryPoint</span> <span class="n">authenticationEntryPoint</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">authenticationEntryPoint</span> <span class="o">=</span> <span class="n">authenticationEntryPoint</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">AuthenticationEntryPoint</code>타입의 객체를 받는데, <code class="language-plaintext highlighter-rouge">HttpStatusEntryPoint</code> 클래스는 <code class="language-plaintext highlighter-rouge">AuthenticationEntryPoint</code>를 상속받아 구현되었기에 인자로 쓸 수 있다. 다행스럽게도 <code class="language-plaintext highlighter-rouge">HttpStatusEntryPoint</code>는 비교적 간단하게 구현되어있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">HttpStatusEntryPoint</span> <span class="kd">implements</span> <span class="nc">AuthenticationEntryPoint</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">HttpStatus</span> <span class="n">httpStatus</span><span class="o">;</span>

	<span class="cm">/**
	 * Creates a new instance.
	 * @param httpStatus the HttpStatus to set
	 */</span>
	<span class="kd">public</span> <span class="nf">HttpStatusEntryPoint</span><span class="o">(</span><span class="nc">HttpStatus</span> <span class="n">httpStatus</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">httpStatus</span><span class="o">,</span> <span class="s">"httpStatus cannot be null"</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">httpStatus</span> <span class="o">=</span> <span class="n">httpStatus</span><span class="o">;</span>
	<span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></table></code></div></div><p>간단하게 <code class="language-plaintext highlighter-rouge">httpStatus</code>만 넘겨주면 알아서 인증에 실패했을때 인자로 넘긴 <code class="language-plaintext highlighter-rouge">httpStatus</code>에러를 발생시킨다는 것이다. 이는 메세지를 넘기도록 커스텀마이징도 가능하다. 하단에 있는 Reference를 참고하면 된다.</p><p>아무튼 나는 <code class="language-plaintext highlighter-rouge">HttpStatus.UNAUTHORIZED</code>를 넘겨 401 UnAuthorized를 발생시키도록 설정해놨다.</p><ul><li>11 : 말그대로 필터를 등록한다는 것이다.</ul><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>addFilterBefore(filter A, filter B.class): filter A 추가 (filter B보다 우선)
</pre></table></code></div></div><p>그렇기에 향후 작성할 jwt관련 필터는 <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code>라는 필터보다 먼저 실행될 것이다.</p><p>그러면 또 새로운 <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code>에 대해 간단히 알 필요가 있다.</p><h3 id="usernamepasswordauthenticationfilter"><span class="mr-2"><strong>UsernamePasswordAuthenticationFilter</strong></span><a href="#usernamepasswordauthenticationfilter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>코드 자체는 어렵지 않으나 내부동작이 어렵다. 간단히만 알아볼 것이다.</p><p>이것은 jwt토큰만들때 + user정보 찾을때와 연동이 되어야하기에 대략적인 느낌만 적어둘것이다. 향후 위의 두 가지를 다룰때 상세히 적어보도록 하겠다.</p><p>코드를 까보면</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsernamePasswordAuthenticationFilter</span> <span class="kd">extends</span> <span class="nc">AbstractAuthenticationProcessingFilter</span> <span class="o">{</span>

	<span class="o">...</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Authentication</span> <span class="nf">attemptAuthentication</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">AuthenticationException</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">postOnly</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"POST"</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">AuthenticationServiceException</span><span class="o">(</span><span class="s">"Authentication method not supported: "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span>
		<span class="o">}</span>
		<span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">obtainUsername</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
		<span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="n">username</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">username</span><span class="o">.</span><span class="na">trim</span><span class="o">()</span> <span class="o">:</span> <span class="s">""</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">obtainPassword</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
		<span class="n">password</span> <span class="o">=</span> <span class="o">(</span><span class="n">password</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">password</span> <span class="o">:</span> <span class="s">""</span><span class="o">;</span>
		<span class="nc">UsernamePasswordAuthenticationToken</span> <span class="n">authRequest</span> <span class="o">=</span> <span class="nc">UsernamePasswordAuthenticationToken</span><span class="o">.</span><span class="na">unauthenticated</span><span class="o">(</span><span class="n">username</span><span class="o">,</span>
				<span class="n">password</span><span class="o">);</span>
		<span class="c1">// Allow subclasses to set the "details" property</span>
		<span class="n">setDetails</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">authRequest</span><span class="o">);</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">getAuthenticationManager</span><span class="o">().</span><span class="na">authenticate</span><span class="o">(</span><span class="n">authRequest</span><span class="o">);</span>
	<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 되어있다. <code class="language-plaintext highlighter-rouge">POST</code>요청이 아닌경우에는 에러를 발생시킨다. 문제는 <code class="language-plaintext highlighter-rouge">String username = obtainUsername(request);</code>이 구문이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">protected</span> <span class="nc">String</span> <span class="nf">obtainUsername</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">usernameParameter</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 이놈은 헤더에서 값을 찾는데, 어떻게 JSON으로 요청을 보내는데 받는다는 말인가?</p><p>이는 나중에 작성할 jwt필터에서 이미 인증정보를 넣었기 때문이라고 말할 수 있다.</p><p>jwt 필터에는 다음과 같은 코드가 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Authentication</span> <span class="n">auth</span> <span class="o">=</span> <span class="n">jwtService</span><span class="o">.</span><span class="na">getAuthentication</span><span class="o">(</span><span class="n">jwt</span><span class="o">);</span>
<span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">auth</span><span class="o">);</span>
</pre></table></code></div></div><p>Authentication이라는 객체를 만들어서 시큐리티 컨텍스트에 넣고있다. 기존 <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code>에서는 <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationToken()</code>메소드를 호출하여 컨텍스트에 넣고 있는데, 내가 만든 <code class="language-plaintext highlighter-rouge">jwtService.getAuthentication()</code>을 보면</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="o">...</span>
<span class="kd">public</span> <span class="nc">Authentication</span> <span class="nf">getAuthentication</span><span class="o">(</span><span class="nc">String</span> <span class="n">jwtToken</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="n">userServiceDetail</span><span class="o">.</span><span class="na">loadUserByUsername</span><span class="o">(</span><span class="n">getEmail</span><span class="o">(</span><span class="n">jwtToken</span><span class="o">));</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="nc">User</span><span class="o">)</span><span class="n">userDetails</span><span class="o">;</span>
        <span class="nc">UserAuth</span> <span class="n">authenticatedUser</span> <span class="o">=</span> <span class="nc">UserAuth</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getUsername</span><span class="o">())</span>
                <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">UsernamePasswordAuthenticationToken</span><span class="o">(</span><span class="n">authenticatedUser</span><span class="o">,</span><span class="s">""</span><span class="o">,</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">());</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>유저객체로 토큰을 만들어서 리턴하고 jwt필터에서는 이를 시큐리티 컨텍스트에 넣고 있는것이다.</p><p>실제로 jwt필터의 <code class="language-plaintext highlighter-rouge">auth</code>를 찍어보면</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="mi">2022</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">11</span> <span class="mi">23</span><span class="o">:</span><span class="mi">42</span><span class="o">:</span><span class="mf">53.205</span>  <span class="no">INFO</span> <span class="mi">14560</span> <span class="o">---</span> <span class="o">[</span><span class="n">nio</span><span class="o">-</span><span class="mi">8080</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="mi">2</span><span class="o">]</span> <span class="n">c</span><span class="o">.</span><span class="na">i</span><span class="o">.</span><span class="na">r</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">jwt</span><span class="o">.</span><span class="na">JwtAuthenticationFilter</span>      <span class="o">:</span> <span class="nl">auth:</span> <span class="nc">UsernamePasswordAuthenticationToken</span> <span class="o">[</span><span class="nc">Principal</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">realworld</span><span class="o">.</span><span class="na">domain</span><span class="o">.</span><span class="na">aggregate</span><span class="o">.</span><span class="na">user</span><span class="o">.</span><span class="na">dto</span><span class="o">.</span><span class="na">UserAuth</span><span class="err">@</span><span class="mi">216</span><span class="n">ee17a</span><span class="o">,</span> <span class="nc">Credentials</span><span class="o">=[</span><span class="no">PROTECTED</span><span class="o">],</span> <span class="nc">Authenticated</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">Details</span><span class="o">=</span><span class="kc">null</span><span class="o">,</span> <span class="nc">Granted</span> <span class="nc">Authorities</span><span class="o">=[]]</span>
</pre></table></code></div></div><p>이렇게 출력되는것을 볼 수 있다.</p><p>사실 이를 이해하려면 Spring-Security 내부동작에 대해 좀 더 학습해야하는 것 같다.</p><h2 id="결론"><span class="mr-2">결론</span><a href="#결론" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Spring Web설정에 대해 이해하려고 했다.</p><p>고작 구현은 30줄인 코드를 해석하는데 vscode 기준 300줄이 넘는 설명을 덧붙였다.</p><p>그리고 글을 작성하는데 2일이 걸렸다.. 부족한 부분은 따로 회사 점심시간에 찾아보고 그래도 글이 많이 부족하다.</p><p>그리고 Spring Security는 진짜 방대하다는것을 다른 문서들을 찾아보면서 느꼈다.</p><p>내가 글을 좀 더 잘 썼다면 정리가 더 잘되고 깔끔한 글이 되었을텐데 아쉽다.</p><h2 id="reference"><span class="mr-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://engineering-skcc.github.io/spring-security-series/Spring-Security-guide/">https://engineering-skcc.github.io/spring-security-series/Spring-Security-guide/</a> SK C&amp;C Tech 블로그<li><a href="https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter">https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter</a><li><a href="https://stackoverflow.com/questions/56388865/spring-security-configuration-httpsecurity-vs-websecurity">https://stackoverflow.com/questions/56388865/spring-security-configuration-httpsecurity-vs-websecurity</a> 스택오버플로우 WebSecurity vs WebSecurity<li><a href="https://zzang9ha.tistory.com/341">https://zzang9ha.tistory.com/341</a> CSRF에 대하여<li><a href="https://catsbi.oopy.io/c0a4f395-24b2-44e5-8eeb-275d19e2a536">https://catsbi.oopy.io/c0a4f395-24b2-44e5-8eeb-275d19e2a536</a> Spring Security 로그인 상세정리글.<li><a href="https://sas-study.tistory.com/362">https://sas-study.tistory.com/362</a> exceptionHandling 커스텀마이징<li><a href="https://ckinan.com/blog/spring-security-credentials-from-json-request/">https://ckinan.com/blog/spring-security-credentials-from-json-request/</a> 필터 동작방식 조금</ul><blockquote class="prompt-tip"><div><p>현재 이 프로젝트는 vue.js + vite + vuex + Spring boot, Spring Data JPA + Spring Security 를 이용하여 real-world 데모버전을 제작완료하였습니다. <a href="https://github.com/kkminseok/real-world-springboot">https://github.com/kkminseok/real-world-springboot</a></p></div></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/toy/'>Toy</a>, <a href='/categories/real-world-spring/'>real-world-spring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >Spring</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기 - 민석강&amp;url=https://kkminseok.github.io/posts/realworld05/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기 - 민석강&amp;u=https://kkminseok.github.io/posts/realworld05/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://kkminseok.github.io/posts/realworld05/&amp;text=real-world프로젝트 Spring 시작하기(5) - 회원가입 만들기 전 설정 Web설정파일 만들기 - 민석강" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/2023-03-06-dnd/">DND 8기 활동 후기</a><li><a href="/posts/2024-03-31-fastapi/">fastapi Swagger Response 분리하기</a><li><a href="/posts/2023-05-19-think01/">5월19일시점 개발하면서 고민한 것들 + 도커관련 이슈</a><li><a href="/posts/2023-05-02-Modern-Java-In-action/">2번 읽는 Modern Java In Action - Chapter06 스트림으로 데이터 수집</a><li><a href="/posts/2023-03-18-Modern-Java-In-Action/">2번 읽는 Modern Java In Action - Chapter01 기초</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/algorithmstudy/">AlgorithmStudy</a> <a class="post-tag" href="/tags/top100like/">Top100Like</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/fastapi/">FastAPI</a> <a class="post-tag" href="/tags/economy/">Economy</a> <a class="post-tag" href="/tags/dp/">DP</a> <a class="post-tag" href="/tags/top100interview/">Top100Interview</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/realworld_01/"><div class="card-body"> <em class="timeago small" data-ts="1662998520" > 2022-09-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>real-world프로젝트 Spring 시작하기(1) - real-world란?</h3><div class="text-muted small"><p> real-world project 구현 과정 카테고리 보기 먼저 우아한형제 리얼월드 글에서 글을 읽어보면 이해하기 편하다. 나는 저 글을 읽고 시작할때 어떻게 해야할지 감을 못잡았다. 현재 리얼월드를 Spring + boot + JPA + thymeleaf 템플릿엔진 + js (Axios or Ajax)로 구현할 예정이다. 기술스택은 바...</p></div></div></a></div><div class="card"> <a href="/posts/realworld_02/"><div class="card-body"> <em class="timeago small" data-ts="1663171320" > 2022-09-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>real-world프로젝트 Spring 시작하기(2) - DDD입문 프로젝트 구조 설정.</h3><div class="text-muted small"><p> real-world project 구현 과정 카테고리 보기 나는 당연하게도 웹 애플리케이션 제작이고, 배운게 간단한 3-tier 아키텍처라, Repository, Service, Controller로 분리하였다. 근데 Real-world의 다른 데모앱들은 프로젝트 구조를 거의 도메인 중심으로 가져갔다. 이때까지는 이해못했다. 왜 저렇게 했...</p></div></div></a></div><div class="card"> <a href="/posts/realworld_03/"><div class="card-body"> <em class="timeago small" data-ts="1663174920" > 2022-09-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>real-world프로젝트 Spring 시작하기(3) - AutoTest gitAction적용, 설명</h3><div class="text-muted small"><p> real-world project 구현 과정 카테고리 보기 저번 포스팅때 API구현을 한다고 하였지만, 이미 구현한 상태에서 느끼기엔 언젠가 Git Action을 쓸 거 지금 미리쓰면 좋다고 생각하였다. 이게 선행되어야된다고 생각하고 만약 다시 만든다면 CI구축을 할 것이므로 API구현보다 빠른 순서에 넣었다. 간단한 GitAction에 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Spring_Mvc_vs_Ant/" class="btn btn-outline-primary" prompt="Older"><p>Spring Security - mvcMatchers vs antMatchers</p></a> <a href="/posts/realworld06/" class="btn btn-outline-primary" prompt="Newer"><p>real-world프로젝트 Spring 시작하기(6) - Jwt Filter 만들기 전 JWT,쿠키,세션 설명</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "kkminseok/kkminseok.github.io", "data-repo-id": "MDEwOlJlcG9zaXRvcnkzNDUwNzI2OTM=", "data-category": "Announcements", "data-category-id": "DIC_kwDOFJFkNc4CO5-J", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/none">kang minseok</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/leetcode/">leetcode</a> <a class="post-tag" href="/tags/programmers/">Programmers</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/algorithmstudy/">AlgorithmStudy</a> <a class="post-tag" href="/tags/top100like/">Top100Like</a> <a class="post-tag" href="/tags/spring/">Spring</a> <a class="post-tag" href="/tags/fastapi/">FastAPI</a> <a class="post-tag" href="/tags/economy/">Economy</a> <a class="post-tag" href="/tags/dp/">DP</a> <a class="post-tag" href="/tags/top100interview/">Top100Interview</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KMXXJ0D586"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KMXXJ0D586'); }); </script>
