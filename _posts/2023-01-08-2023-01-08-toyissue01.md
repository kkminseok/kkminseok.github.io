---
title: my-Repository-Trafficí”„ë¡œì íŠ¸ ì´ìŠˆ - Python third-party mockingí•˜ê¸°
author: 
    name: minseok
    link: https://github.com/kkminseok
date: 2023-01-08 00:02:00 +0800
categories: [Toy,my-Repository-Traffic]
tags: [Spring]
math: true
mermaid: true
image: 
    path: 
comments: true
---

> [my-Repository-Traffic ì €ì¥ì†Œ](https://github.com/kkminseok/my-Repository-Traffic)
{: .prompt-info}

## ğŸ˜‚ ê°œìš”

í”„ë¡œì íŠ¸ëŠ” github APIë¥¼ ë‹¤ë¥¸ `Third-party`ë¥¼ ì´ìš©í•´ì„œ í˜¸ì¶œí•˜ê³  ìˆì—ˆë‹¤.

ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ì§œë ¤ë‹¤ë³´ë‹ˆ.. `Third-party` APIë“¤ì€ ì–´ë–»ê²Œ ëª¨í‚¹í•˜ì§€?

ì˜ë¬¸ì´ ë“¤ì—ˆë‹¤.

`chatGPT`ì—ê²Œ ë¬¼ì–´ë´ì„œ í•´ê²°í•˜ê¸´ í–ˆì§€ë§Œ ê·¸ ê³¼ì •ì„ ì ê³  ì´í•´í•˜ê¸° ìœ„í•´ ë¸”ë¡œê·¸ì— ì ëŠ”ë‹¤.

## ğŸ”… í™˜ê²½

```python
def get_all_repositories_cloner(repositories: github.PaginatedList.PaginatedList) -> dict:
    cloner_counts = {}
    for repository in repositories:
        clone_traffic = get_repository_clone_traffic(repository)
        unique_cloner = clone_traffic['uniques']
        if unique_cloner == 0:
            continue
        cloner_counts[repository.full_name] = unique_cloner
    return cloner_counts

def get_repository_clone_traffic(repository: github.Repository.Repository) -> dict:
    return repository.get_clones_traffic()
```

ì´ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•´ì•¼í•œë‹¤.

`get_all_repositories_cloner()` íŒŒë¼ë¯¸í„°ë¥¼ ë³´ë©´ `github.PaginatedList.PaginatedList`ë¼ëŠ” íƒ€ì…ì„ ë°›ëŠ”ë°, ì´ëŠ” `pygithub`ë¼ëŠ” ì¨ë“œíŒŒí‹°ì—ì„œ ì œê³µí•˜ëŠ” ìë£Œí˜•ì´ë‹¤.

`for`ë¬¸ì„ ë„ëŠ” ë¶€ë¶„ì´ ìˆëŠ”ë°, ì´ ì½”ë“œê°€ ëŒ ìˆ˜ ìˆê²Œ ì ì ˆíˆ ëª¨í‚¹í•´ì¤˜ì•¼í•œë‹¤.

ë˜í•œ `cloner_counts[repository.full_name]`ì— `repository.full_name`ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ëª¨í‚¹í•´ì¤˜ì•¼í•œë‹¤.

ê·¸ë ‡ê¸°ì— **`repositories`ë¼ëŠ” ì¸ìë¥¼ ëª¨í‚¹í•´ì¤˜ì•¼í•˜ê³ **, `get_repository_clone_traffic()` ëª¨í‚¹, `for`ë¬¸ì„ ëŒ ìˆ˜ ìˆê²Œ í•´ì•¼í•˜ê³ ,  `.`ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê°ì²´ë¡œ ë§Œë“¤ì–´ì•¼í•œë‹¤.

## ğŸ˜Š ë°©ë²•

```python
@pytest_asyncio.fixture
async def repositories() -> github.PaginatedList.PaginatedList:
    class Repository:
        def __init__(self, full_name):
            self.full_name = full_name

    mock_paginated_list = MagicMock(spec=github.PaginatedList.PaginatedList)
    mock_paginated_list.__iter__.return_value = iter([
        Repository(full_name="kkminseok.repo1"),
        Repository(full_name="kkminseok.repo2"),
        Repository(full_name="kkminseok.repo3"),
    ])
    return mock_paginated_list
```

ë¨¼ì €, `PaginatedList` ìë£Œí˜•ìœ¼ë¡œ ë°˜í™˜í•´ì•¼í•˜ê³ , `.`ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì„œ ë¦¬í„´í•˜ë„ë¡ í•˜ì˜€ë‹¤.

ê·¸ë¦¬ê³ , `for`ë¬¸ì„ ëŒê¸° ìœ„í•´ì„œ `__iter__`ë¥¼ ëª¨í‚¹í•˜ì˜€ê³ , `MagicMock`ì„ í†µí•´ ìë£Œí˜•ì„ ì§€ì •í•˜ì˜€ë‹¤.

ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œëŠ”

```python
def test_get_all_repositories_cloner(repositories: github.PaginatedList.PaginatedList, mocker: MockerFixture):
    mocker.patch("git_utils.get_repository_clone_traffic", return_value={"uniques": 100})
    result = get_all_repositories_cloner(repositories)
    assert len(result) == 3
    assert result['kkminseok.repo1'] == 100
    assert result['kkminseok.repo2'] == 100
    assert result['kkminseok.repo3'] == 100
```

ì´ë ‡ê²Œ í˜¸ì¶œí•´ì£¼ë©´ ëœë‹¤.

ë§‰ìƒ ì§œê³ ë‚˜ë‹ˆ ë³„ ê±° ì•„ë‹Œë°.. ì€ê·¼ ëª¨í‚¹í•˜ëŠ”ë° ì˜¤ë˜ ê±¸ë ¸ë‹¤.



