---
title: Docker(1) - Docker 개념
author: 
    name: minseok
    link: https://github.com/kkminseok
date: 2022-05-08 00:00:00 +0800
categories: [Docker,CS]
tags: [Docker]
math: true
mermaid: true
image: 
  path: /assets/img/sample/logo.jpg
comments : true
---


> 원본은 <http://pyrasis.com/docker.html>에 있습니다.!!
{: .prompt-tip }

# 1. Docker

- 2013년 Docker, Inc(구 dotCloud)에서 출시한 오픈 소스 컨테이너 프로젝트
- 2010년 이후 서버 시장이 클라우드 환경으로 옮겨지면서 생성된 가상 서버에 각종 소프트웨어를 설치하고 설정해야하는 경우가 많아짐.
- 하지만 특정 소프트웨어의 버전을 설치해야하고 그것을 따로 문서화하고 각각 서버마다 설치하기가 번거로워진다.
- 셸 스크립트로 설치 및 설정 자동화를 구현하였지만 한계가 있었다다. 셸 스크립트로만은 중앙 관리 기능이나 복잡한 기능은 구현하기가 힘든것.!! 특히 사소한 설정 하나가 운영체제와 서비스의 안정성에 큰 영향을 미치기에 더욱 난이도가 높았던 것이다.

이러한 상황에서 Immutable Infrastructure라는 것이 나왔습니다.

이는 호스트OS와 서비스 운영 환경(`소스코드`,`컴파일된 바이너리 파일`) 등을 분리하고 한 번 설정한 운영 환경은 변경하지 않는(`Immutable`)원칙을 따르게 됩니다.

즉 서비스 운영 환경을 이미지로 생성한 뒤 서버에 배포하여 실행하게 됩니다.

클라우드가 서버를 한 번 쓰고 버리는것처럼 이러한 서비스도 운영 환경 이미지를 한 번 쓰고 버리게 됩니다.

# 2. Immutable InfraStructure

이러한 서비스는 여러가지 장점이 있습니다.

- 이미지 자체만 관리하면 되기에 관리가 편합니다.
- 이미지 하나로 서버를 계속 직어낼 수 있기에 확장성이 큽니다.
- 개발자의 PC나 테스트 서버에서 이미지를 실행하기만 하면 서비스 운영 환경과 동일한 환경에서 구성되기에 테스트가 쉽습니다.
- 운영체제와 서비스 운영 환경을 분리하여 가볍습니다.

이러한 장점을 가지고 이 프로젝트를 구현한 것이 `Docker`입니다.

`Docker`는 서비스 운영에 필요한 모든 요소를 모아 `Docker`컨테이너에 넣습니다.(`pyp`, `apaceh`, `java`, 등) 자신이 작성한 프로그램도 넣을 수 있습니다.

# 3. Docker vs 가상 머신

Docker와 가상머신은 비슷합니다.

왜냐하면 가상머신에서 리눅스를 설치하고 각종 프로그램과 DB등을 설치하는데 이렇게 생성된 가상 머신 이미지 파일을 여러 서버에 복사해서 실행하면 이미지 하나로 서버를 계속 만들어낼 수 있기 때문입니다.

하지만 가상 머신은 리얼 머신에 비해 아직 속도가 많이 느립니다.

이러한 `전가상화`의 느린 속도를 개선하기 위해 `반가상화` 방식이 개발되었고, 널리 쓰이고 있습니다.

하지만 가상 머신 자체도 결국 완전한 컴퓨터라 게스트 OS설치가 필요하고 이로 인해서 이미지의 용량이 커진다는 단점이 있습니다.

이렇게 무거운 가상화 이미지를 주고받는건 붇마이 있을 수 밖에 없고 애초에 가상화에 초점이 맞춰져 있기 때문에 이미지를 배포하고 관리하는 기능은 부족할 수 밖에 없습니다.

반면에 `Docker`는 게스트 OS를 설치하지 않습니다.

서버 운영을 위한 프로그램과 라이브러리만 격리해서 설치할 수 있고, OS 자원들은 호스트와 공유합니다. 이렇게 되면서 이미지 용량이 크게 줄었습니다.

Docker는 가상 머신과 달리 하드웨어를 가상화하는 계층이 없기에 메모리 접근, 파일시스템, 네트워크 속도 등이 호스트와 거의 동일한 속도라 볼 수 있습니다.

`Docker`는 `Git`처럼 버전 관리 기능을 제공합니다.
저장소에 이미지를 올리고, 받을 수 있고 그 이미지를 공유할 수 있는 `DockerHub`도 제공합니다.

# 4. 컨테이너

리눅스/유닉스 환경은 `chroot`라는 명령어가 있습니다.

이 명령어를 루트 디렉터리(`/`)를 변경해줍니다. 이렇게 루트를 바꾸면 루트 바깥의 파일과 디렉터리에 접근할 수 없게 됩니다. 

이러한 점 때문에 해당 명령어는 보안적으로 정보 유출과 피해를 최소화하는데 주로 사용되었습니다.

해당 공간에 디렉터리에 들어갈 파일과 공유 라이브러리는 본인이 직접 준비해야하고 설정 또한 복잡하였습니다. 또한 결국 완벽한 가상화가 아니기에 각종 제약도 있었습니다.

이 때문에 리눅스는 `LXC(LinuX Container)`라는 시스템 레벨 가상화를 제공하였습니다. 리눅스 커널 레벨에서 제공하는 가상의 격리 공간으로, 이 공간에는 OS가 설치되지 않기에 가상머신이라고 부르지 않고, 컨테이너라고 부르게 됩니다.

리눅스 커널의 `Control Groups`는 cpu, memory, network, disk 등을 할당하여 완전한 형태의 가상 공간을 제공합니다. 또한 파일 시스템, IPC 등을 격리시켜 호스트와 별개의 공간을 만듭니다. 이것을 `namespaces`라고 합니다.

즉, `LXC`는 `Control Groups` + `namespaces`를 통해 가상 공간을 제공합니다.

하지만 `LXC`는 결국 격리된 공간만 제공할 뿐 서버 운영에 대한 기능이 부족하였습니다.

이러한 부가적인 기능을 추가한 것이 `Docker`입니다. 

초기에 `Docker`는 `LXC`를 기반으로 구현되었지만 0.9버전부터는 `libcontainer`(Docker 내부에서는 native로 표기되나봄)를 개발하여 사용하고 있습니다.

![](/assets/img/DockerPost/pyrasis_docker/9.png)  
> 출처 :  http://blog.docker.com/2014/03/docker-0-9-introducing-execution-drivers-and-libcontainer



