---
title: real-worldí”„ë¡œì íŠ¸ Spring ì‹œì‘í•˜ê¸°(3) - AutoTest gitActionì ìš©, ì„¤ëª…
author: 
    name: minseok
    link: https://github.com/kkminseok
date: 2022-09-15 01:02:00 +0800
categories: [Toy,real-world-spring]
tags: [Spring]
math: true
mermaid: true
image: 
    path: /assets/img/realworld/realworldLogo.png
comments: true
---

> [real-world project êµ¬í˜„ ê³¼ì • ì¹´í…Œê³ ë¦¬ ë³´ê¸°](https://kkminseok.github.io/categories/real-world-spring/)
{: .prompt-info}


ì €ë²ˆ í¬ìŠ¤íŒ…ë•Œ APIêµ¬í˜„ì„ í•œë‹¤ê³  í•˜ì˜€ì§€ë§Œ, ì´ë¯¸ êµ¬í˜„í•œ ìƒíƒœì—ì„œ ëŠë¼ê¸°ì—” ì–¸ì  ê°€ Git Actionì„ ì“¸ ê±° ì§€ê¸ˆ ë¯¸ë¦¬ì“°ë©´ ì¢‹ë‹¤ê³  ìƒê°í•˜ì˜€ë‹¤.

ì´ê²Œ ì„ í–‰ë˜ì–´ì•¼ëœë‹¤ê³  ìƒê°í•˜ê³  ë§Œì•½ ë‹¤ì‹œ ë§Œë“ ë‹¤ë©´ CIêµ¬ì¶•ì„ í•  ê²ƒì´ë¯€ë¡œ APIêµ¬í˜„ë³´ë‹¤ ë¹ ë¥¸ ìˆœì„œì— ë„£ì—ˆë‹¤.

ê°„ë‹¨í•œ GitActionì— ëŒ€í•´ì„œëŠ” í° ê³µë¶€ í•„ìš”ì—†ì´ ë„íì½ê³  ì‘ì„±í•˜ë©´ ëœë‹¤.

í…œí”Œë¦¿ë„ ì œê³µí•˜ê³  ìˆìœ¼ë‹ˆ.. ì°¸ê³ í•˜ì.

ë¨¼ì € ì½”ë“œë¥¼ ë³´ë©´

```yml
name: auto test java

on:
  push:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Java JDK
        uses: actions/setup-java@v3.5.0
        with:
          distribution: 'temurin'
          java-version: '18'
          
      - name: Grant execute permission gradlew
        run: chmod +x gradlew
        
      - name: Build
        run: ./gradlew build -x test
      
      - name: Test
        run: SPRING_PROFILES_ACTIVE=[test] ./gradlew test
      
      - name: Publish Test Results
        uses: EnricoMi/publish-unit-test-result-action@v2
        if: always()
        with:
          junit_files: "build/test-results/test/**/*.xml"
```

ìœ„ì—ì„œ ë¶€í„° í•˜ë‚˜ì”© ê³µë¶€í•´ë³´ì•˜ë‹¤.

- `name` : ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ì´ ì „ì²´ íë¦„ì¸ ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„ì´ë‹¤. ê³µì‹ë¬¸ì„œì— ë”°ë¥´ë©´ ì‘ì„±ì„ í•˜ì§€ ì•Šìœ¼ë©´ `root`ê¸°ì¤€ì˜ íŒŒì¼ê²½ë¡œê°€ ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„ì´ ëœë‹¤ê³  í•œë‹¤. ì‘ì„±ì‹œì—ëŠ”

![](/assets/img/realworld/workflow_name.png)


- `on:push:branches` : ì›Œí¬í”Œë¡œìš°ê°€ ì‘ë™í•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ ì •ì˜í•˜ëŠ” êµ¬ë¬¸ì´ë‹¤. `on`ì´ ë‹¬ë ¤ìˆìœ¼ë©´ ê·¸ ë’¤ì—ëŠ” íŠ¸ë¦¬ê±° ì—­í• ì„ í•œë‹¤. ë’¤ì— ìˆëŠ” `push`ì™€ `branches`ëŠ” íŠ¸ë¦¬ê±°ë¥¼ ì‘ë™ì‹œí‚¤ëŠ” ì¡°ê±´ì¸ ê²ƒì´ë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œëŠ” ë§ˆìŠ¤í„° ë¸ŒëŸ°ì¹˜ê°€, pushí–ˆì„ë•Œ ì´ íŠ¸ë¦¬ê±°ë¥¼ ì‘ë™ì‹œí‚¤ê²Œ ì„¤ì •í•´ë†¨ë‹¤.

- `jobs` : workflowê°€ ì‘ë™ì‹œí‚¬ ì¼ë“¤ì„ ì •ì˜í•œë‹¤. ë”°ë¡œ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ë³‘ë ¬ì ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤ê³  í•œë‹¤. í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì—¬ëŸ¬ jobì„ ì§€ì •í•˜ì§€ ì•Šì„ê²ƒì´ë¯€ë¡œ ì•Œì•„ë§Œ ë‘ì—ˆë‹¤.
  
- `build` : buildëŠ” ë¬¸ë²•ì´ ì•„ë‹ˆë‹¤. ë³´í†µ ë‹¹ì—°í•˜ê²Œ jobs:build:~ë¡œ í•´ë†”ì„œ ì—¬ê¸°ê¹Œì§€ ë¬¸ë²•ì¸ì¤„ ì•Œì•˜ëŠ”ë° ê·¸ê²Œ ì•„ë‹ˆê³  **jobì˜ unique**í•œ ì´ë¦„ì´ë‹¤. ì¦‰, buildë¼ëŠ” ì´ë¦„ì„ ì§€ì •í•´ì¤€ê²ƒ. ê·¸ë˜ì„œ buildë¼ê³  ì§€ì •í•˜ì§€ ì•Šê³  **realworld_test**ë¡œ ì§€ì •í•´ë³´ì•˜ë‹¤. 
![](/assets/img/realworld/workflow_job_name.png)
ëŠë‚Œì´ í™• ì˜¨ë‹¤. 

- `runs-on` : ê°„ë‹¨í•˜ê²Œ êµ¬ë™ë  í™˜ê²½ì„ ì„¤ì •í•œë‹¤. ìœˆë„ìš°, ë§¥í™˜ê²½ë„ ê°€ëŠ¥í•˜ë‹¤. ë³´í†µ ë¦¬ëˆ…ìŠ¤í™˜ê²½ì—ì„œ ëŒë¦¬ë¯€ë¡œ **ubuntu-latest**ë¡œ ì§€ì •í•˜ì˜€ë‹¤.

- `steps` : ì•ìœ¼ë¡œ ì§€ì •í•´ì¤„ ì—°ì†ì ì¸ taskë“¤ì„ ë§í•œë‹¤. `run`ì´ë¼ëŠ” ëª…ë ¹ì–´ë¥¼ í†µí•´ taskë“¤ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. **ëª¨ë“  runë“¤ì´ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ, ëª¨ë“  runë“¤ì€ stepsì•ˆì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤.** ë‹¹ì¥ ìœ„ì˜ ì½”ë“œë§Œ ë´ë„ `run`ì´ ì—†ëŠ” `steps`ë“¤ì´ ìˆë‹¤. 
  
- `uses` : ê³µìš© ë ˆí¼ì§€í† ë¦¬, ê³µê°œëœ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ì‘ì—…ë‹¨ìœ„ë¥¼ ê°€ì ¸ë‹¤ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆê²Œ í•œë‹¤. {ì†Œìœ ì}/{ì €ì¥ì†Œëª…}@{ì°¸ì¡°ì} ë“±ì˜ ë¬¸ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ìœ„ì˜ ê²½ìš°
```text
uses: actions/checkout@v3
uses: EnricoMi/publish-unit-test-result-action@v2
```
ì´ë ‡ê²Œ ì“°ì¸ ë‘ê°œë¥¼ ë³´ë©´, ì†Œìœ ìëŠ” `action`, `EnricoMi`ì´ê³  ì €ì¥ì†Œëª…ì€ `checkout`ê³¼ `publish-unit-test-result-action`ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë˜í•œ ì°¸ì¡°ìëŠ” `v3`ê³¼ `v1`ì¸ë° ë°°í¬ëœ ì£¼ìš” ë²„ì „ëª… ë° ë¸Œëœì¹˜ë¥¼ ë„£ì„ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ì‹¤ì œë¡œ <https://github.com/EnricoMi/publish-unit-test-result-action>ì— ì ‘ê·¼í•˜ë©´ ì € ë ˆí¬ì§€í† ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- `with` : withì€ ìœ„ì˜ `uses`ë¥¼ ì‚¬ìš©í•  ë•Œ í•„ìš”í•œ ì¸í’‹ê°’ë“¤ì„ ì„¤ì •í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
ìœ„ì˜ ì½”ë“œì—ì„œ

```yml
with:
    distribution: 'temurin'
    java-version: '18'
```
ì˜ ì˜ë¯¸ëŠ” ì €ë°” ë²„ì „ì„ 18ë¡œ ë§ì¶”ê³  Eclipse Temurinì €ì¥ì†Œì—ì„œ jdkë¥¼ ë°›ì•„ì˜¬ ê²ƒì„ ì•Œë ¤ì£¼ëŠ” ê²ƒì´ë‹¤.

## â˜ï¸ETC

ì´ì œ ë‚¨ì€ êµ¬ë¬¸ë“¤ì— ëŒ€í•œ ê°„ë‹¨í•œ í•´ì„ì„ í•´ë³¼ ê²ƒì´ë‹¤.

```yml
run: SPRING_PROFILES_ACTIVE=[test] ./gradlew test
```

ëŠ” ì™œ ì‘ì„±í•˜ì˜€ë‚˜ë©´, ì´ë¥¼ ì‘ì„±í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ Spring Testë¥¼ Githubì—ì„œ ì‹¤í–‰í•  ë•Œ DataBase Connectì„ ì°¾ì§€ ëª»í•´ì„œ ì—ëŸ¬ê°€ ëœ¬ë‹¤.

ì™œì§€? profileì´ ë­”ë°? ì´ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ì„œ ìŠ¤í”„ë§ ë¶€íŠ¸ ê³µì‹ ë¬¸ì„œë¥¼ ì‚´í´ë³´ì•˜ë‹¤.
<https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.profiles>

?? ë¬´ìŠ¨ testí™˜ê²½ì„ ë¶„ë¦¬í•œë‹¤ëŠ”ë°..ê·¸ëŸ´ë ¤ë©´ testíŒŒì¼ì„ ì‘ì„±í•´ì•¼í•œë‹¤ê³  í–ˆë‹¤. ê·¼ë° ë‚œ testíŒŒì¼ì„ ì‘ì„±í•œ ì ì´ ì—†ë‹¤.

```yml
spring.profiles.active=test
```
ì´ëŸ° êµ¬ë¬¸ì„ ì§œì•¼í•œë‹¤ëŠ”ë° ë‚˜ëŠ” ì´ëŸ° êµ¬ë¬¸ì„ ì‘ì„±í•œ ì ì´ ì—†ë‹¤. ê·¼ë° ëœë‹¤?

ê·¸ë˜ì„œ ì½”ë“œë¥¼ ì§€ì›Œë³´ê³  ë‹¤ì‹œ actionì„ ëŒë ¤ë´¤ë‹¤.

![](/assets/img/realworld/profile_delete.png)

ì˜ ëœë‹¤?

ìƒê°í•´ë³´ì•˜ë‹¤. ì™œ ì´ ì½”ë“œê°€ í•„ìš” ì—†ì—ˆëŠ”ì§€

ì²˜ìŒì— ì»¤ë„¥ì…˜ ì¦‰, ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ì„¤ì •ì„ ëª»ì°¾ì•„ì„œ í…ŒìŠ¤íŠ¸ê°€ ì˜¤ë¥˜ê°€ ë‚¬ë‹¤.

ê·¸ë˜ì„œ testsí´ë”ì•ˆì— appliation.propertiesë¥¼ ì‘ì„±í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ì„¤ì •ì„ ì‚½ì…í•˜ì˜€ë‹¤.

```yml
# H2
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=create
spring.jpa.properties.hibernate.format_sql=true
spring.jpq.show-sql=true

#secret

real-world.token.expiry=3000000
real-world.token.key=realworldPostGreSQL0132474654564564213131d31vfxvjfijkjdks

```

ê·¸ë¦¬ê³  gitActionì— spring boot Profile ê´€ë ¨ ì½”ë“œë¥¼ ë„£ì—ˆë‹¤.

ê·¸ë¬ë”ë‹ˆ ë˜ì—ˆë‹¤.

ì¦‰, ì´ë¯¸ appplication.propertiesë¥¼ ì‘ì„±í•œ ì‹œì ë¶€í„° ë˜ëŠ”ê±°ì˜€ë‹¤.

ê¹ƒ ì•¡ì…˜ì„ ì‘ì„±í•  ë‹¹ì‹œ <https://jane514.tistory.com/4>ì´ ë¸”ë¡œê·¸ë¥¼ ì°¸ì¡°í•˜ì—¬ ì‘ì„±í•˜ì˜€ëŠ”ë°, ë¬´ë¶„ë³„í•˜ê²Œ ì‘ì„±í•˜ë‹ˆê¹Œ ë¶ˆí•„ìš”í•œ ì½”ë“œë¥¼ ì‚½ì…í•˜ê²Œ ëœ ê²ƒì´ë‹¤.

ì•„ì§ ê³µë¶€ê°€ ë” í•„ìš”í•˜ê² ì§€ë§Œ ê·¸ë ‡ë‹¤.

ë•Œë¬¸ì— ë°”ë€ ì½”ë“œëŠ”

```yml
name: auto test java

on:
  push:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Java JDK
        uses: actions/setup-java@v3.5.0
        with:
          distribution: 'temurin'
          java-version: '18'
          
      - name: Grant execute permission gradlew
        run: chmod +x gradlew
        
      - name: Build
        run: ./gradlew build -x test
      
      - name: Test
      #  run: SPRING_PROFILES_ACTIVE=[test] ./gradlew test
        run: ./gradlew test
      
      - name: Publish Test Results
        uses: EnricoMi/publish-unit-test-result-action@v2
        if: always()
        with:
          junit_files: "build/test-results/test/**/*.xml"
```
ê°€ ë  ê²ƒì´ë‹¤.


ë‹¤ìŒ êµ¬ë¬¸ì€ ì´ê²ƒì´ë‹¤.

```yml
- name: Publish Test Results
  uses: EnricoMi/publish-unit-test-result-action@v2
  if: always()
  with:
    junit_files: "build/test-results/test/**/*.xml"
```

ì´ êµ¬ë¬¸ì¸ë°, ì´ëŠ” ì €ê¸° ëª…ì‹œëœ ì €ì¥ì†Œì— ë¬¸ë²•ì´ ì„¤ëª…ë˜ì–´ ìˆë‹¤.

`if: alway()` : ì´ êµ¬ë¬¸ì€ ì•ì˜ stepsë“¤ì—ì„œ ì‹¤íŒ¨ê°€ ë‚˜ë„ ë¬´ì¡°ê±´ ì‹¤í–‰í•˜ë„ë¡ ë³´ì¥í•˜ëŠ” ì½”ë“œë¼ê³  í•œë‹¤.

`with:junit_files: "build/test-results/test/**/*.xml"` : `with`ì— ëŒ€í•´ì„œëŠ” ìœ„ì—ì„œ ì„¤ëª…í–ˆë‹¤. ì—¬ê¸°ì„œ `junit_files:~`êµ¬ë¬¸ì€ `junit_files`ë¼ëŠ” ë³€ìˆ˜ë¥¼ ìƒì„±í•˜ê³  ì € ê°’ì„ ë„£ì–´ì„œ `uses`ì˜ ì¸í’‹ì— ì „ë‹¬í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

ì—¬ê¸°ì„œ ì„¤ì •í•´ì¤˜ì•¼í• ê²ƒì´ ìˆëŠ”ë°, ë’¤ì— ìˆëŠ” `build~`ëŠ” ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” pathì—¬ì•¼í•œë‹¤. 

![](/assets/img/realworld/path_1.png)
ë‚´ í”„ë¡œì íŠ¸ì˜ ê²½ìš°, junitì„ í†µí•´ testë¥¼ ì‹¤í–‰í•˜ë©´ build/test-results/test/binary/??.xmlì— ìŒ“ì¸ë‹¤. ì´ ê²½ë¡œë¥¼ ì ì–´ì¤˜ì•¼í•œë‹¤. ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥¼ê²ƒì´ë¯€ë¡œ ì˜ í™•ì¸í•´ì„œ ì¨ì•¼í•œë‹¤.

ë§Œì•½ ì œëŒ€ë¡œëœ ê²½ë¡œë¥¼ ì ì§€ ì•Šì•˜ì„ ê²½ìš°

![](/assets/img/realworld/path_error.png)

ì²˜ëŸ¼ `Could not find any files for ë³¸ì¸ì´ ì‘ì„±í•œ Path`ê°€ ëœ¨ê³ , Test Resultsì—ëŠ” ì•„ë¬´ê²ƒë„ ìˆ˜í–‰ë˜ì§€ ì•Šì„ ê²ƒì´ë‹¤.

ë”ìš± ë¬´ì„œìš´ ì ì€ ì´ í…ŒìŠ¤íŠ¸ê°€ â˜‘ï¸ê°€ ëœ¨ë©° **ì„±ê³µ**ìœ¼ë¡œ ëœ¬ë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•˜ë‹¤.

## Next

ë‹¤ìŒì€ User Singupê´€ë ¨ ì„œë¹„ìŠ¤ë“¤ì„ ì‘ì„±í•´ë³¼ ê²ƒì´ë‹¤. 


### Reference

- <https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions> gitaction ê³µì‹ë¬¸ì„œ
- <https://github.com/EnricoMi/publish-unit-test-result-action> junit gitaction uiê´€ë ¨ ì €ì¥ì†Œ
- <https://jane514.tistory.com/4> java gitacion ê´€ë ¨

> í˜„ì¬ ì´ í”„ë¡œì íŠ¸ëŠ” vue.js  + Spring boot, Spring Data JPAë¥¼ ì´ìš©í•œ í’€ìŠ¤íƒê°œë°œ, ì»¨íŠ¸ë¦¬ë·°ì…˜ì— ëª©í‘œë¥¼ ë‘ê³  ìˆìŠµë‹ˆë‹¤. <https://github.com/kkminseok/real-world-springboot> ë”°ë´‰ ëˆŒëŸ¬ì£¼ì„¸ìš”.ğŸ™
{: .prompt-tip}