---
title: real-worldí”„ë¡œì íŠ¸ Spring ì‹œì‘í•˜ê¸°(4) - íšŒì›ê°€ì… ë§Œë“¤ê¸° ì „ ì„¤ì • ë° ì˜ì¡´ì„± íŒŒì¼ë“¤ ì„¤ëª….
author: 
    name: minseok
    link: https://github.com/kkminseok
date: 2022-09-20 00:02:00 +0800
categories: [Toy,real-world-spring]
tags: [Spring]
math: true
mermaid: true
image: 
    path: /assets/img/realworld/realworldLogo.png
comments: true
---

> [real-world project êµ¬í˜„ ê³¼ì • ì¹´í…Œê³ ë¦¬ ë³´ê¸°](https://kkminseok.github.io/categories/real-world-spring/)
{: .prompt-info}

[ë°±ì—”ë“œ ëª…ì„¸ì„œ](https://realworld-docs.netlify.app/docs/specs/backend-specs/endpoints)ë¥¼ ë³´ë©´ Authentication : `POST /api/users/login` ê³¼ Registration `POST /api/users`ì— ê²¹ì¹˜ëŠ” urlì´ ì¡´ì¬í•œë‹¤. `/api/users`ë‹¤.

ì´ë¥¼ prefixë¡œ í•´ì£¼ëŠ” ë°©ë²•ì´ ìˆì„ê±°ë¼ ìƒê°í•´ë´¤ë‹¤.

- 1ë²ˆ `@RequestMapping()`ì•ˆì—ë‹¤ê°€ `/api/users`ê¹Œì§€ë§Œ ì ê¸°
- 2ë²ˆ `application.propeties`ì„¤ì • íŒŒì¼ì— ì„¤ì •í•˜ê¸°.

```text
 server.servlet.contextPath=/api     ë¥¼ ì ì–´ì£¼ë©´ ëœë‹¤.
 ```

 ì²˜ìŒì—ëŠ” 2ë²ˆì˜ ê²½ìš°ë¡œ í–ˆìœ¼ë‚˜, Webconfigì— í—ˆìš©ë²”ìœ„ì„¤ì • ë“±ì„í•  ë•Œ ë‚´ê°€ ê³„ì† prefixë¥¼ ì ì–´ë†¨ë‹¤ëŠ”ê±¸ ê¹Œë¨¹ì–´ì„œ ì—ëŸ¬ë¥¼ ë§ì´ ë°œìƒì‹œì¼°ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ `WebConfig`ì„¤ì • íŒŒì¼ ì¤‘ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì ì„ ìˆ˜ ìˆë‹¤.

 ```java
 .antMatchers("/api/users/**").permitAll()
 ```

ì´ ëœ»ì€ '/api/users/~~~'ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“ ê²ƒë“¤ì— ëŒ€í•´ ì¸ì¦ì—†ì´ ìš”ì²­ì„ í—ˆìš©í•œë‹¤ëŠ” ê²ƒì¸ë° 2ë²ˆì²˜ëŸ¼ ì„¤ì •íŒŒì¼ì— prefixë¥¼ ì„¤ì •í•´ë²„ë¦¬ë©´

 ```java
 .antMatchers("/users/**").permitAll()
 ```

ë¡œ ì ì–´ì¤˜ì•¼í•œë‹¤. ì„¤ì •íŒŒì¼ì˜ prefixê°€ ìš°ì„ ì´ë‹¤. ì´ê±¸ë¡œ ëª‡ ë²ˆì„ í•´ë§¸ê³ , êµ³ì´ ì´ë ‡ê²Œí• ê±°ë©´ APIëª…ì„¸ëŠ” ì™œ ìˆê² ëŠ”ê°€ ìƒê°í•˜ì—¬ 1ë²ˆ ë°©ì‹ìœ¼ë¡œ ë°”ê¿”ë²„ë ¸ë‹¤.

ê·¸ë˜ì„œ ê·¸ëƒ¥ 1ë²ˆ ë°©ë²•ìœ¼ë¡œ í–ˆë‹¤. WebConfigì— ê´€í•´ì„œëŠ” ë’¤ì—ì„œ ë˜ ë‹¤ë¤„ë³¼ ê²ƒì´ë‹¤.

ëª…ì„¸ì—ì„œ ë³´ë©´ íšŒì›ê°€ì…ì‹œ `jwt`ë¥¼ ì´ìš©í•´ì„œ tokenë„ í¬í•¨í•œ ê°ì²´ë¥¼ ë¦¬í„´í•´ì•¼í•˜ëŠ”ë° ì´ëŠ” ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¨ê¸°ë¡œ í•˜ê³  tokenì„ ì œì™¸í•œ ì„¤ì • ë° íšŒì›ê°€ì… 3-tierë¥¼ ë³µê¸°í•˜ê² ë‹¤.

ë¨¼ì €, ì˜ì¡´ì„±ì„ ì‚´í´ë³´ì. ë‚˜ì˜ í”„ë¡œì íŠ¸ í™˜ê²½ì´ë‹¤.

```text
Spring : 2.7.3
java : 18 
dependencies {
    org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-test'
    implementation 'org.projectlombok:lombok:1.18.24'
    implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
    implementation 'io.jsonwebtoken:jjwt-impl:0.11.5'
    implementation 'io.jsonwebtoken:jjwt-jackson:0.11.5'

    annotationProcessor 'org.projectlombok:lombok'
    implementation group: 'org.bgee.log4jdbc-log4j2', name: 'log4jdbc-log4j2-jdbc4', version: '1.16'
    // inmemory
    runtimeOnly 'com.h2database:h2'


    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.boot:spring-boot-starter-jdbc:2.7.3'
    testImplementation 'org.springframework.security:spring-security-test'
}
```

ì°¸ê³ ë¡œ ì´ëŠ” ë” ì¶”ê°€ë˜ê³  ìˆë‹¤. 

Spring 2.7.3 ë²„ì „ê³¼ java 18ì„ ì“´ ê±´ ê·¸ëƒ¥ ìµœì‹ ë²„ì „ì´ë¼ ì“´ê±°ë‹¤.

ê·¼ë° Springì€ .. ì„¤ì • ë¶€ë¶„ì´ ë§ì´ ë°”ë€Œì—ˆë”ë¼. íŠ¹íˆ `deprecated`ëœ ê²ƒë“¤ ì²˜ë¦¬í•˜ëŠë¼ ì• ë¨¹ì—ˆë‹¤.

ìë°”ì™€ ìŠ¤í”„ë§ ì„¤ëª…ì„ ì´ë ‡ê²Œ í•´ë‘ê³  `dependencies`ë¥¼ í•˜ë‚˜ì”© ëœ¯ì–´ë³´ê² ë‹¤.

## spring-boot-stater-security

ë§ì€ê²ƒì„ í¬í•¨í•˜ê³  ìˆì§€ë§Œ, ì¸ì¦ì„ êµ¬í˜„í•˜ë ¤ë©´ ì´ í”„ë ˆì„ì›Œí¬ê°€ ê°€ì§€ê³  ìˆëŠ” ê²ƒë“¤ì„ ì‚¬ìš©í•´ì•¼í•œë‹¤.

ì˜ˆë¥¼ë“¤ë©´ ìœ„ì—ì„œ ë§í•œ WebConfig ì„¤ì •ì„ í•´ì¤˜ì„œ ìš”ì²­ì—ëŒ€í•´ ì¸ê°€í•˜ê±°ë‚˜ ì¸ê°€í•˜ì§€ ì•Šê±°ë‚˜ë¥¼ ì •í•  ìˆ˜ ìˆë‹¤.

ì´ í”„ë ˆì„ì›Œí¬ë¥¼ ì„í¬íŠ¸ í•˜ëŠ”ìˆœê°„ ëª¨ë“  ìš”ì²­ì— ì¸ì¦ì´ í•„ìš”í•´ì ¸ì„œ ì„¤ì •ì„ ë”°ë¡œ í•´ì¤˜ì•¼í•œë‹¤.

## spring-boot-starter-validation

ëŒ€í‘œì ìœ¼ë¡œ `@Valid`ë¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ì“°ê¸°ìœ„í•¨ì´ë‹¤. `@Valid`ëŠ” ì´ë¦„ì—ì„œë„ ì•Œ ìˆ˜ ìˆê²Œ ê²€ì¦ì„ í•œë‹¤. ì—¬ê¸°ì„œëŠ” `@RequestBody`ì™€ í•¨ê»˜ ì“°ì—¬ ìš”ì²­ ê°ì²´ë¥¼ **ê²€ì¦**í•  ê²ƒì´ë‹¤. ê²€ì¦ë°©ì‹ì€ ê°ì²´DTOì— ë”°ë¡œ ì •ì˜í•´ì•¼í•œë‹¤. `NotNULL`ì–´ë…¸í…Œì´ì…˜ì„ ë‹¬ê±°ë‚˜, `@Email` ì–´ë…¸í…Œì´ì…˜ì„ ë‹¤ëŠ” í•„ë“œì— ë§ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ë‹¬ì•„ì£¼ë©´ ì•Œì•„ì„œ ê²€ì¦ì„ í•´ì¤€ë‹¤.

ì‹¤ì œ ì½”ë“œì—ì„œëŠ” ì´ë ‡ê²Œ ì“°ì¸ë‹¤.

```java
public UserResponse signup(@Valid @RequestBody  UserSignupRequest userSignupRequest) {
    return userService.signup(userSignupRequest);
}
```

ì´ëŸ¬ë©´ `UserSignupRequest`ì— ê²€ì¦ ë°©ì‹ì´ ë“¤ì–´ìˆì–´ì•¼í•œë‹¤.

```java
@Getter
@AllArgsConstructor
@Builder
@JsonTypeName("user")
@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.WRAPPER_OBJECT)
public class UserSignupRequest {

    @NotBlank
    private String username;
    @Email
    private String email;
    @NotBlank
    private String password;
}
```

Json~ì–´ë…¸í…Œì´ì…˜ì„ ë¬´ì‹œí•˜ê¸¸ ë°”ë€ë‹¤. ë‚˜ì¤‘ì— ë˜ ë³µê¸°í•  ê²ƒì´ë‹¤.

ì´ë ‡ê²Œ ì ì–´ë†“ìœ¼ë©´ `username`,ê³¼ `password`ëŠ” ë¹ˆ ê°’, nullì´ ë“¤ì–´ì˜¬ ìˆ˜ ì—†ê³  `email`ì€ Emailí˜•ì‹ì„ ì§€í‚¤ê²Œ í•´ë†“ëŠ”ë‹¤. ì°¸ê³ ë¡œ  `@Email` ì–´ë…¸í…Œì´ì…˜ì€ nullì„ í—ˆìš©í•œë‹¤.


## spring-boot-starter-data-jpa

JPAë¥¼ ì¢€ ë” ì‰½ê²Œ ë‹¤ë£¨ê¸° ìœ„í•¨ì´ë‹¤. ì²˜ìŒì—ëŠ” ê³µë¶€ì˜ ëª©ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•˜ì—¬ ëª¨ë“ ê±¸ êµ¬í˜„í•  ìƒê°ì´ì—ˆì§€ë§Œ, ìƒì‚°ì„±ë„ í¬ê²Œ ì¤„ì–´ë“¤ê³  ìë£Œê°€ ì˜ ë‚˜ì™€ìˆì§€ ì•Šë‹¤.. êµ¬ê¸€ë§í•˜ë©´ ëŒ€ë¶€ë¶„ì´ Spring-data-jpaë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì“´ë‹¤. ìˆœìˆ˜ jpaë¥¼ ê³µë¶€í•˜ë ¤ë©´ ê¹€ì˜í•œ ì„ ìƒë‹˜ì˜ ì±…ì„ ì‚¬ì•¼í•  ê²ƒ ê°™ë‹¤.

## spring-boot-starter-web

Webê³¼ ê´€ë ¨ë˜ì–´ìˆëŠ” í”„ë ˆì„ì›Œí¬ë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ `Filter`ë¥¼ êµ¬í˜„í•  ìˆ˜ ì—†ê³ , `HttpServletRequest`, `HttpServletResponse` ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. real-worldëŠ” Web Application êµ¬í˜„ì— ëª©ì ì„ ë‘ê³  ìˆìœ¼ë‹ˆ ì‚¬ìš©í•˜ëŠ”ê²Œ ë§ë‹¤. ë˜í•œ API í˜¸ì¶œì„ ìœ„í•´ì„  ë‹¹ì—°íˆ ì‚¬ìš©í•´ì•¼í•œë‹¤.

## spring-boot-starter-test

ì´ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë©´ `@SpringBootTest`ì™€ `WebMvcTest` ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°, í–¥í›„ ì½”ë“œì—ì„œ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ ê·¸ë•Œê°€ì„œ ìì„¸íˆ ë³µê¸°í•  ê²ƒì´ë‹¤.

## lombok

ì ì ˆí•œ ë¡¬ë³µ ì‚¬ìš©ì€ ì‚¬ë‘ì´ë¼ëŠ” ê²ƒì„ ì•Œì•˜ë‹¤.

## jjwt-api:0.11.5

`jjwt-api`ëŠ” `Claims`, ì˜ˆì™¸ì²˜ë¦¬ì¸ `ExpiredJwtException`, `Jwts`, `Keys`ë¼ëŠ” ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆë‹¤.

- `Claims`ëŠ” í† í°ì— ë‹´ëŠ” ì •ë³´ì´ë‹¤.
- `ExpiredJwtException`ì€ í† í°ì„ ìƒì„±í•  ë•Œì˜ ì§€ì •í•œ ìœ íš¨ê¸°ê°„ì´ ì§€ë‚¬ëŠ”ì§€ í™•ì¸í•˜ê³  ì§€ë‚¬ì„ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ëŠ” Exceptionì´ë‹¤.
- `Jwts`ëŠ” jwtí† í°ì„ `builder`ë¥¼ í†µí•´ ë§Œë“¤ê±°ë‚˜ `parser`ë¥¼ í†µí•´ ì •ë³´ë¥¼ ë½‘ì•„ë‚´ëŠ” ê°ì²´ì´ë‹¤.
ì°¸ê³ ë¡œ `parser()`ëŠ” deprecatedë˜ì–´ì„œ `parserBuilder()`ë¥¼ ì‚¬ìš©í•´ì•¼í•œë‹¤. ì´ë„ ì• ë¨¹ì—ˆë‹¤.
ì•„ë§ˆ ë§ì€ê³³ë“¤ì—ì„œëŠ” 0.9ë²„ì „ì„ ì‚¬ìš©í•˜ëŠ”ë° ì—¬ê¸°ëŠ” `parser()`ê°€ ì‚¬ìš©ê°€ëŠ¥í•  ê²ƒì´ë‹¤.

ì™œ Deprecatedë˜ì—ˆëŠ”ì§€ëŠ” ì°¾ì•„ë³´ê³  ë‚˜ì¤‘ì— ë³µê¸°í•  ë•Œ ì“¸ ìˆ˜ ìˆìœ¼ë©´ ì“°ê² ë‹¤.


## jjwt-impl:0.11.5

ì´ê±° ì—†ìœ¼ë©´ ì—ëŸ¬ë‚¸ë‹¤. ìœ„ì˜ `jjwt-api`ì—ì„œ ì •ì˜ë˜ì–´ ìˆëŠ” `Claims`ì˜ ì½”ë“œë¥¼ ê¹Œë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ìê°€ ì •ì˜ ë˜ì–´ìˆë‹¤.

```java
public static Claims claims() {
    return Classes.newInstance("io.jsonwebtoken.impl.DefaultClaims");
}
```

ì´ëŠ” `jjwt-impl`ì— ì •ì˜ë˜ì–´ìˆëŠ” í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ëœ»ì´ë‹¤.

![](/assets/img/realworld/jjwt_impl.png)

ì°¸ê³ ë¡œ importë˜ì–´ ìˆì§€ ì•Šì•„ë„ Springì´ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•´ì£¼ë¯€ë¡œ ê±±ì •í•˜ì§€ë§ë¼.

```text
ì—ëŸ¬ë‚´ìš©
io.jsonwebtoken.lang.UnknownClassException: Unable to load class named [io.jsonwebtoken.impl.DefaultClaims] from the thread context, current, or system/application ClassLoaders.  All heuristics have been exhausted.  Class could not be found.  ->>Have you remembered to include the jjwt-impl.jar in your runtime classpath?<<-
```

## jjwt-jackson

ì´ê²Œ ìˆì–´ì•¼ JJWTê°€ í† í°ì„ ìƒì„±í• ë•Œ ìë™ìœ¼ë¡œ Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°€ì ¸ë‹¤ JSONë§¤í•‘ì„ í•œë‹¤ê³  í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì´ë„ í•„ìš”í•œê²ƒ. ì´ê²Œ ì—†ìœ¼ë©´ ë˜ ì—ëŸ¬ë‚œë‹¤.
ì´ëŠ” JSONì— ëŒ€í•´ì„œ ì—ëŸ¬ê°€ ë‚˜ëŠ”ê²Œ ì•„ë‹ˆê³ , Serializerë¥¼ ëª»í•´ì„œ ë‚˜ëŠ” ì—ëŸ¬ê°™ë‹¤. í† í°ì„ ë§Œë“¤ë•Œ compact()í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼í•˜ëŠ”ë°, ì´ ë¶€ë¶„ì—ì„œ Serializerë¥¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
ì»¤ìŠ¤í…€ìœ¼ë¡œ ë”°ë¡œ êµ¬í˜„í•˜ê±°ë‚˜ ë§ëŠ” êµ¬í˜„ì²´ë¥¼ ë¼ì›Œë„£ìœ¼ë¼ê³  í•œë‹¤.

```text
ì—ëŸ¬ë‚´ìš©
Unable to find an implementation for interface io.jsonwebtoken.io.Serializer using java.util.ServiceLoader. Ensure you include a backing implementation .jar in the classpath, for example jjwt-impl.jar, or your own .jar for custom implementations.
```

## implementation group: 'org.bgee.log4jdbc-log4j2', name: 'log4jdbc-log4j2-jdbc4', version: '1.16'

log4jì™€ jdbcë¥¼ ì—°ê²°í•˜ì—¬ ë§Œë“¤ì–´ì§„ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¡œ, DBê´€ë ¨ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ê±°ë‚˜ í•„í„°ë§í•´ì„œ í•„ìš”í•œ ë¡œê·¸ë§Œ ì¶œë ¥í•œë‹¤. íŒŒì¼ë¡œ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ë„ ìˆë‹¤. í•„ìš”ì—†ë‹¤ë©´ ë¹¼ë„ ëœë‹¤.

## testImplementation

testImplementationëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìˆ˜í–‰í•  ë•Œë§Œ ì ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤. 

ì—¬ê¸°ì„œ ìƒˆë¡œ ë“±ì¥í•˜ëŠ”ê±´ `spring-security-test`ì´ë‹¤.

## spring-security-test

ì•„ì§ ê³µë¶€ì¤‘ì´ë‹¤. í†µí•©í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•œë‹¤ê³  í•  ë•Œ ìœ ì € ì¸ì¦ì€ ì–´ë–»ê²Œ í• ê²ƒì¸ê°€? í•„í„°ëŠ” ì–´ë–»ê²Œ ì ìš©ë˜ê³ ? ì´ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ í™˜ê²½ì„ êµ¬ì¶•í•˜ëŠ”ë° ë„ì™€ì£¼ëŠ” í•˜ìœ„ í”„ë ˆì„ì›Œí¬ë‹¤.
ì„ì‹œë¡œ ì¸ì¦ì„ í•˜ê±°ë‚˜ ì¸ì¦ì„ ë¬´ì‹œí•  ìˆ˜ë„ ìˆë‹¤.

ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸í™˜ê²½ì„ êµ¬ì¶•í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤. ì´ê±° ë‚˜ì¤‘ì— ì§„ì§œ ê³¨ë¨¸ë¦¬ ì•„í”„ë‹¤.


> í˜„ì¬ ì´ í”„ë¡œì íŠ¸ëŠ” vue.js  + Spring boot, Spring Data JPAë¥¼ ì´ìš©í•œ í’€ìŠ¤íƒê°œë°œ, ì»¨íŠ¸ë¦¬ë·°ì…˜ì— ëª©í‘œë¥¼ ë‘ê³  ìˆìŠµë‹ˆë‹¤. <https://github.com/kkminseok/real-world-springboot> ë”°ë´‰ ëˆŒëŸ¬ì£¼ì„¸ìš”.ğŸ™
{: .prompt-tip}